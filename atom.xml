<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>è´¹é»˜ - åˆ†äº«</title>
  
  <subtitle>Just run.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://lilong7676.github.io/"/>
  <updated>2023-10-19T06:40:25.120Z</updated>
  <id>https://lilong7676.github.io/</id>
  
  <author>
    <name>lilong7676</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>nodejsä¸­ çš„ AsyncLocalStorage</title>
    <link href="https://lilong7676.github.io/2023/07/21/javascript/nodejs%E4%B8%AD%E7%9A%84-AsyncLocalStorage/"/>
    <id>https://lilong7676.github.io/2023/07/21/javascript/nodejsä¸­çš„-AsyncLocalStorage/</id>
    <published>2023-07-21T06:47:16.000Z</published>
    <updated>2023-10-19T06:40:25.120Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼€é—¨è§å±±ï¼šä»€ä¹ˆæ˜¯-AsyncLocalStorage"><a href="#å¼€é—¨è§å±±ï¼šä»€ä¹ˆæ˜¯-AsyncLocalStorage" class="headerlink" title="å¼€é—¨è§å±±ï¼šä»€ä¹ˆæ˜¯ AsyncLocalStorage"></a>å¼€é—¨è§å±±ï¼šä»€ä¹ˆæ˜¯ AsyncLocalStorage</h2><p>æ ¹æ® Node.js <a href="https://nodejs.org/docs/latest-v14.x/api/async_hooks.html#async_hooks_class_asynclocalstorage" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼šâ€This class is used to create asynchronous state within callbacks and promise chains. It allows storing data throughout the lifetime of a web request or any other asynchronous duration. It is similar to thread-local storage in other languages.â€ï¼Œ</p><p>ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–è§£é‡Šï¼ŒAsyncLocalStorage å…è®¸ä½ åœ¨æ‰§è¡Œå¼‚æ­¥å‡½æ•°æ—¶å­˜å‚¨çŠ¶æ€ï¼Œç„¶åä½¿å…¶å¯ç”¨äºè¯¥å‡½æ•°ä¸­çš„æ‰€æœ‰ä»£ç è·¯å¾„ã€‚</p><h3 id="åœºæ™¯ï¼šä¸€ä¸ªæ¡ˆä¾‹å¼•å…¥"><a href="#åœºæ™¯ï¼šä¸€ä¸ªæ¡ˆä¾‹å¼•å…¥" class="headerlink" title="åœºæ™¯ï¼šä¸€ä¸ªæ¡ˆä¾‹å¼•å…¥"></a>åœºæ™¯ï¼šä¸€ä¸ªæ¡ˆä¾‹å¼•å…¥</h3><p>å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªï¼Ÿå°±æ˜¯è¯´å¦‚ä½•ç¡®å®šä¸€ä¸ªRequestä»å‘èµ·åˆ°è¿”å›å¤„ç†ç»“æŸè¿‡ç¨‹ä¸­çš„æ‰€æœ‰è°ƒç”¨è·¯å¾„ï¼Ÿä¸€èˆ¬æ˜¯é€šè¿‡å‘èµ·æ–¹æºå¸¦ä¸€ä¸ªå”¯ä¸€è¯·æ±‚æ ‡è¯†ï¼Œå¯ä»¥å«traceIdï¼Œä»¥æ­¤æ¥å®ç°é“¾è·¯è¿½è¸ªï¼Œå®ç°æ—¥å¿—æº¯æºç­‰ã€‚</p><h3 id="å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªæœºåˆ¶ï¼Ÿ"><a href="#å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªæœºåˆ¶ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªæœºåˆ¶ï¼Ÿ"></a>å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªæœºåˆ¶ï¼Ÿ</h3><h4 id="æ–¹æ¡ˆä¸€ï¼šå…¨å±€å˜é‡-globalTraceId-ï¼Ÿ"><a href="#æ–¹æ¡ˆä¸€ï¼šå…¨å±€å˜é‡-globalTraceId-ï¼Ÿ" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šå…¨å±€å˜é‡ globalTraceId ï¼Ÿ"></a>æ–¹æ¡ˆä¸€ï¼šå…¨å±€å˜é‡ globalTraceId ï¼Ÿ</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Raw Node.js HTTP server</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">let</span> globalTraceId <span class="comment">// ï£¿å…¨å±€å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 0. å¤„ç†è¯·æ±‚çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleRequest</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç”Ÿæˆå”¯ä¸€ traceIdï¼Œæ¯æ¬¡è¯·æ±‚è¿›å…¥ï¼Œå¤å†™ globalTraceId çš„å€¼</span></span><br><span class="line">  globalTraceId = generateTraceId()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ£€æŸ¥ç”¨æˆ·cookieæ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">  cookieValidator().then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¡éªŒæˆåŠŸï¼Œè¿”å›ç»™ç”¨æˆ·ä»–éœ€è¦çš„å†…å®¹</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123; <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span> &#125;);</span><br><span class="line">    res.write(<span class="string">'Congrats! Your damn cookie is the best one!'</span>);</span><br><span class="line">    res.end();</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ï£¿ æŠŠ traceId è¿åŒ error ä¸ŠæŠ¥ç»™å¼‚å¸¸ç›‘æ§ç³»ç»Ÿ</span></span><br><span class="line">    reportError(err, globalTraceId)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™çŠ¶æ€ç 500å’Œé”™è¯¯ä¿¡æ¯ç­‰</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. åˆ›å»º server </span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  handleRequest(req, res)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è®© server å’Œ port:3000 å»ºç«‹ socket é“¾æ¥ï¼ŒæŒç»­æ¥æ”¶ç«¯å£ä¿¡æ¯</span></span><br><span class="line">server.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Server listening on port 3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä¼šå‡ºç°çš„é—®é¢˜æ˜¯ç”±äºnodejså•çº¿ç¨‹æ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼ŒglobalTraceIdè¢«èµ‹å€¼ï¼Œç„¶åè¿›å…¥åˆ°å¼‚æ­¥æ£€æŸ¥ç”¨æˆ·cookieçš„é€»è¾‘ä¸­ï¼Œæ­¤æ—¶nodeçš„main stackæ˜¯ç©ºçš„ï¼Œäº‹ä»¶å¾ªç¯ä¼šæ‰§è¡Œå¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚æ­¤æ—¶å°±ä¼šå¯¼è‡´globalTraceIdè¢«è¦†å†™ï¼Œå¯¼è‡´ç¬¬ä¸€ä¸ªè¯·æ±‚çš„å¼‚æ­¥æ£€æŸ¥ä¸­é”™è¯¯ä¸ŠæŠ¥çš„globalTraceIdæ˜¯é”™è¯¯çš„ã€‚</p><a id="more"></a><h4 id="æ–¹æ¡ˆäºŒï¼šç›´æ¥é€ä¼ å‚æ•°"><a href="#æ–¹æ¡ˆäºŒï¼šç›´æ¥é€ä¼ å‚æ•°" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šç›´æ¥é€ä¼ å‚æ•°"></a>æ–¹æ¡ˆäºŒï¼šç›´æ¥é€ä¼ å‚æ•°</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleRequest</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> traceId = req.headers[<span class="string">'x-trace-id'</span>] || generateTraceId();</span><br><span class="line">  <span class="comment">// æŠŠ traceId å†™å…¥ req è¿™ä¸ª objectï¼Œå°†å‚æ•°ä¸€è·¯å¸¦ä¸‹å»</span></span><br><span class="line">  req.traceId = traceId;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŒä¸Š</span></span><br><span class="line">  cookieValidator().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¡éªŒæˆåŠŸï¼Œè¿”å›ç»™ç”¨æˆ·ä»–éœ€è¦çš„å†…å®¹</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ï£¿ ä¸ŠæŠ¥ traceId</span></span><br><span class="line">    reportError(err, req.traceId)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™çŠ¶æ€ç 500å’Œé”™è¯¯ä¿¡æ¯ç­‰</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cookieValidator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// do someting</span></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤åçœç•¥ç›‘å¬ç­‰æ“ä½œ</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ç®€å•ç²—æš´ï¼Œçš„ç¡®å¯è¡Œã€‚é—®é¢˜å°±æ˜¯æ¯æ¬¡éƒ½å¾—é€ä¼ å‚æ•°ï¼Œå†™èµ·æ¥æœ‰ç‚¹éº»çƒ¦ã€‚</p><h3 id="æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨-AsyncLocalStorage-å®ç°"><a href="#æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨-AsyncLocalStorage-å®ç°" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ AsyncLocalStorage å®ç°"></a>æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ AsyncLocalStorage å®ç°</h3><p>ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå®ç°äº†ä¸€ä¸ªæ—¥å¿—è¿½è¸ªçš„æœ€ç®€é€»è¾‘ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"http"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AsyncLocalStorage &#125; <span class="keyword">from</span> <span class="string">"async_hooks"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸€ä¸ª AsyncLocalStorage å®ä¾‹ï¼Œå¯ä»¥åˆå§‹åŒ–å¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸€ä¸ªå®ä¾‹éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„</span></span><br><span class="line"><span class="keyword">const</span> myAls = <span class="keyword">new</span> AsyncLocalStorage();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logWithId</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå½“å‰çš„alsä¸Šä¸‹æ–‡</span></span><br><span class="line">  <span class="keyword">const</span> context = myAls.getStore();</span><br><span class="line">  <span class="keyword">const</span> id = context.reqId;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;id !== <span class="literal">undefined</span> ? id : <span class="string">"-"</span>&#125;</span>:`</span>, msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> reqId = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡ä¼šè¢«ä¼ é€’ç»™ als å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> myContext = &#123;</span><br><span class="line">      reqId: reqId++,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    åœ¨æä¾›çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­åŒæ­¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°å¹¶è¿”å›å…¶è¿”å›å€¼ã€‚è¿™é‡Œçš„ store åœ¨å›è°ƒå‡½æ•°å¤–éƒ¨æ˜¯ä¸å¯è®¿é—®çš„ï¼Œ</span></span><br><span class="line"><span class="comment">    ä½†æ˜¯åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°å†…éƒ¨åˆ›å»ºçš„ä»»ä½•å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥è®¿é—® storeã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    myAls.run(myContext, () =&gt; &#123;</span><br><span class="line">      logWithId(<span class="string">"start"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥æ“ä½œ</span></span><br><span class="line">      setImmediate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        logWithId(<span class="string">"end"</span>);</span><br><span class="line">        res.end();</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">http.get(<span class="string">"http://localhost:8080"</span>);</span><br><span class="line">http.get(<span class="string">"http://localhost:8080"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°</span></span><br><span class="line"><span class="comment">// 0: start</span></span><br><span class="line"><span class="comment">// 1: start</span></span><br><span class="line"><span class="comment">// 0: end</span></span><br><span class="line"><span class="comment">// 1: end</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸»è¦æ˜¯ç®€å•äº†è§£äº†ä¸‹ nodejs ä¸­ AsyncLocalStorage çš„åˆæ­¥ä½¿ç”¨ï¼Œå½“ç„¶æ›´æ·±å±‚æ¬¡çš„ç†è§£è¿˜éœ€è¦å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ¥ä½“éªŒã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼€é—¨è§å±±ï¼šä»€ä¹ˆæ˜¯-AsyncLocalStorage&quot;&gt;&lt;a href=&quot;#å¼€é—¨è§å±±ï¼šä»€ä¹ˆæ˜¯-AsyncLocalStorage&quot; class=&quot;headerlink&quot; title=&quot;å¼€é—¨è§å±±ï¼šä»€ä¹ˆæ˜¯ AsyncLocalStorage&quot;&gt;&lt;/a&gt;å¼€é—¨è§å±±ï¼šä»€ä¹ˆæ˜¯ AsyncLocalStorage&lt;/h2&gt;&lt;p&gt;æ ¹æ® Node.js &lt;a href=&quot;https://nodejs.org/docs/latest-v14.x/api/async_hooks.html#async_hooks_class_asynclocalstorage&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼šâ€This class is used to create asynchronous state within callbacks and promise chains. It allows storing data throughout the lifetime of a web request or any other asynchronous duration. It is similar to thread-local storage in other languages.â€ï¼Œ&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–è§£é‡Šï¼ŒAsyncLocalStorage å…è®¸ä½ åœ¨æ‰§è¡Œå¼‚æ­¥å‡½æ•°æ—¶å­˜å‚¨çŠ¶æ€ï¼Œç„¶åä½¿å…¶å¯ç”¨äºè¯¥å‡½æ•°ä¸­çš„æ‰€æœ‰ä»£ç è·¯å¾„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;åœºæ™¯ï¼šä¸€ä¸ªæ¡ˆä¾‹å¼•å…¥&quot;&gt;&lt;a href=&quot;#åœºæ™¯ï¼šä¸€ä¸ªæ¡ˆä¾‹å¼•å…¥&quot; class=&quot;headerlink&quot; title=&quot;åœºæ™¯ï¼šä¸€ä¸ªæ¡ˆä¾‹å¼•å…¥&quot;&gt;&lt;/a&gt;åœºæ™¯ï¼šä¸€ä¸ªæ¡ˆä¾‹å¼•å…¥&lt;/h3&gt;&lt;p&gt;å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªï¼Ÿå°±æ˜¯è¯´å¦‚ä½•ç¡®å®šä¸€ä¸ªRequestä»å‘èµ·åˆ°è¿”å›å¤„ç†ç»“æŸè¿‡ç¨‹ä¸­çš„æ‰€æœ‰è°ƒç”¨è·¯å¾„ï¼Ÿä¸€èˆ¬æ˜¯é€šè¿‡å‘èµ·æ–¹æºå¸¦ä¸€ä¸ªå”¯ä¸€è¯·æ±‚æ ‡è¯†ï¼Œå¯ä»¥å«traceIdï¼Œä»¥æ­¤æ¥å®ç°é“¾è·¯è¿½è¸ªï¼Œå®ç°æ—¥å¿—æº¯æºç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªæœºåˆ¶ï¼Ÿ&quot;&gt;&lt;a href=&quot;#å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªæœºåˆ¶ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªæœºåˆ¶ï¼Ÿ&quot;&gt;&lt;/a&gt;å¦‚ä½•å®ç°è¯·æ±‚çš„é“¾è·¯è¿½è¸ªæœºåˆ¶ï¼Ÿ&lt;/h3&gt;&lt;h4 id=&quot;æ–¹æ¡ˆä¸€ï¼šå…¨å±€å˜é‡-globalTraceId-ï¼Ÿ&quot;&gt;&lt;a href=&quot;#æ–¹æ¡ˆä¸€ï¼šå…¨å±€å˜é‡-globalTraceId-ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ¡ˆä¸€ï¼šå…¨å±€å˜é‡ globalTraceId ï¼Ÿ&quot;&gt;&lt;/a&gt;æ–¹æ¡ˆä¸€ï¼šå…¨å±€å˜é‡ globalTraceId ï¼Ÿ&lt;/h4&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Raw Node.js HTTP server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; http = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;http&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; globalTraceId &lt;span class=&quot;comment&quot;&gt;// ï£¿å…¨å±€å˜é‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 0. å¤„ç†è¯·æ±‚çš„æ–¹æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;handleRequest&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;req, res&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ç”Ÿæˆå”¯ä¸€ traceIdï¼Œæ¯æ¬¡è¯·æ±‚è¿›å…¥ï¼Œå¤å†™ globalTraceId çš„å€¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  globalTraceId = generateTraceId()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// æ£€æŸ¥ç”¨æˆ·cookieæ˜¯å¦æœ‰æ•ˆ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  cookieValidator().then(&lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;res&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ ¡éªŒæˆåŠŸï¼Œè¿”å›ç»™ç”¨æˆ·ä»–éœ€è¦çš„å†…å®¹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    res.writeHead(&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;, &amp;#123; &lt;span class=&quot;string&quot;&gt;&#39;Content-Type&#39;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt; &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    res.write(&lt;span class=&quot;string&quot;&gt;&#39;Congrats! Your damn cookie is the best one!&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    res.end();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;).catch(&lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;err&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ï£¿ æŠŠ traceId è¿åŒ error ä¸ŠæŠ¥ç»™å¼‚å¸¸ç›‘æ§ç³»ç»Ÿ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    reportError(err, globalTraceId)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å†™çŠ¶æ€ç 500å’Œé”™è¯¯ä¿¡æ¯ç­‰&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 1. åˆ›å»º server &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; server = http.createServer(&lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;req, res&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  handleRequest(req, res)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 2. è®© server å’Œ port:3000 å»ºç«‹ socket é“¾æ¥ï¼ŒæŒç»­æ¥æ”¶ç«¯å£ä¿¡æ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server.listen(&lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;, () =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;Server listening on port 3000&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;è¿™é‡Œçš„ä¼šå‡ºç°çš„é—®é¢˜æ˜¯ç”±äºnodejså•çº¿ç¨‹æ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼ŒglobalTraceIdè¢«èµ‹å€¼ï¼Œç„¶åè¿›å…¥åˆ°å¼‚æ­¥æ£€æŸ¥ç”¨æˆ·cookieçš„é€»è¾‘ä¸­ï¼Œæ­¤æ—¶nodeçš„main stackæ˜¯ç©ºçš„ï¼Œäº‹ä»¶å¾ªç¯ä¼šæ‰§è¡Œå¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚æ­¤æ—¶å°±ä¼šå¯¼è‡´globalTraceIdè¢«è¦†å†™ï¼Œå¯¼è‡´ç¬¬ä¸€ä¸ªè¯·æ±‚çš„å¼‚æ­¥æ£€æŸ¥ä¸­é”™è¯¯ä¸ŠæŠ¥çš„globalTraceIdæ˜¯é”™è¯¯çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://lilong7676.github.io/categories/javascript/"/>
    
    
      <category term="AsyncLocalStorage" scheme="https://lilong7676.github.io/tags/AsyncLocalStorage/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•é€šè¿‡ SSH åœ¨æœåŠ¡å™¨ä¸Šè¿œç¨‹æ‰§è¡Œå‘½ä»¤</title>
    <link href="https://lilong7676.github.io/2023/03/14/Shell%E8%84%9A%E6%9C%AC/%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87-SSH-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/"/>
    <id>https://lilong7676.github.io/2023/03/14/Shellè„šæœ¬/å¦‚ä½•é€šè¿‡-SSH-åœ¨æœåŠ¡å™¨ä¸Šè¿œç¨‹æ‰§è¡Œå‘½ä»¤/</id>
    <published>2023-03-14T02:38:04.000Z</published>
    <updated>2023-06-08T06:26:43.567Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ€è¿‘ä¹°äº†ä¸€ä¸ªè…¾è®¯äº‘æœåŠ¡å™¨ï¼Œä¸»è¦ç”¨æ¥æ‰˜ç®¡ä¸ªäººé¡¹ç›®ï¼Œç»å¸¸æ‰§è¡Œçš„æ“ä½œæ˜¯sshç™»é™†åˆ°æœåŠ¡å™¨ï¼Œç„¶åæ‰§è¡ŒæŸäº›å‘½ä»¤ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š </p><ol><li>æ‰“å¼€sshç™»é™†è½¯ä»¶ï¼Œç„¶åç™»é™†åˆ°æœåŠ¡å™¨</li><li>æ‰§è¡Œç›¸å…³å‘½ä»¤</li><li>å…³é—­è¿æ¥</li></ol><p>é‚£æœ‰æ²¡æœ‰åŠæ³•ä¸€æ°”å‘µæˆå‘¢ï¼Ÿä¸€ä¸ªå‘½ä»¤å®Œæˆè¿™ä¸¤ä¸ªæ“ä½œï¼ŒæŸ¥äº†ä¸‹èµ„æ–™ï¼Œå½“ç„¶å¯ä»¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -t username@host <span class="string">'commands'</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘æƒ³çœ‹ä¸‹ root ç›®å½•æœ‰å“ªäº›æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/tencent_ecs root@example.com <span class="string">"ls -a; echo \"done\""</span></span><br></pre></td></tr></table></figure><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230314105027.png?x-oss-process=image/resize,w_800" alt></p><a id="more"></a><h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="https://www.cnet.com/tech/computing/ssh-tip-send-commands-remotely/" target="_blank" rel="noopener">SSH tip: Send commands remotely</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æœ€è¿‘ä¹°äº†ä¸€ä¸ªè…¾è®¯äº‘æœåŠ¡å™¨ï¼Œä¸»è¦ç”¨æ¥æ‰˜ç®¡ä¸ªäººé¡¹ç›®ï¼Œç»å¸¸æ‰§è¡Œçš„æ“ä½œæ˜¯sshç™»é™†åˆ°æœåŠ¡å™¨ï¼Œç„¶åæ‰§è¡ŒæŸäº›å‘½ä»¤ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰“å¼€sshç™»é™†è½¯ä»¶ï¼Œç„¶åç™»é™†åˆ°æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œç›¸å…³å‘½ä»¤&lt;/li&gt;
&lt;li&gt;å…³é—­è¿æ¥&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‚£æœ‰æ²¡æœ‰åŠæ³•ä¸€æ°”å‘µæˆå‘¢ï¼Ÿä¸€ä¸ªå‘½ä»¤å®Œæˆè¿™ä¸¤ä¸ªæ“ä½œï¼ŒæŸ¥äº†ä¸‹èµ„æ–™ï¼Œå½“ç„¶å¯ä»¥ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ssh -t username@host &lt;span class=&quot;string&quot;&gt;&#39;commands&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;æ¯”å¦‚æˆ‘æƒ³çœ‹ä¸‹ root ç›®å½•æœ‰å“ªäº›æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ssh -i ~/.ssh/tencent_ecs root@example.com &lt;span class=&quot;string&quot;&gt;&quot;ls -a; echo \&quot;done\&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230314105027.png?x-oss-process=image/resize,w_800&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Shellè„šæœ¬" scheme="https://lilong7676.github.io/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
      <category term="shell" scheme="https://lilong7676.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨peerjså®ç°ä¸€ä¸ªåŸºäºwebrtcçš„ç®€å•è¿œç¨‹ç½‘ç»œæ‘„åƒå¤´</title>
    <link href="https://lilong7676.github.io/2023/03/03/uncategorized/%E4%BD%BF%E7%94%A8peerjs%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8Ewebrtc%E7%9A%84%E7%AE%80%E5%8D%95%E8%BF%9C%E7%A8%8B%E7%BD%91%E7%BB%9C%E6%91%84%E5%83%8F%E5%A4%B4/"/>
    <id>https://lilong7676.github.io/2023/03/03/uncategorized/ä½¿ç”¨peerjså®ç°ä¸€ä¸ªåŸºäºwebrtcçš„ç®€å•è¿œç¨‹ç½‘ç»œæ‘„åƒå¤´/</id>
    <published>2023-03-03T01:38:18.000Z</published>
    <updated>2023-06-08T06:26:43.566Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»“åº“åœ°å€ï¼š<a href="https://github.com/lilong7676/cue-live" target="_blank" rel="noopener">https://github.com/lilong7676/cue-live</a><br>æŠ€æœ¯æ ˆï¼šnextjs + webrtc </p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä»“åº“åœ°å€ï¼š&lt;a href=&quot;https://github.com/lilong7676/cue-live&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/lilong7676/cue-live&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•æ„å»ºå¹¶å‘å¸ƒè‡ªå·±çš„dockeré•œåƒ </title>
    <link href="https://lilong7676.github.io/2023/02/28/uncategorized/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E5%B9%B6%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84docker%E9%95%9C%E5%83%8F/"/>
    <id>https://lilong7676.github.io/2023/02/28/uncategorized/å¦‚ä½•æ„å»ºå¹¶å‘å¸ƒè‡ªå·±çš„dockeré•œåƒ/</id>
    <published>2023-02-28T06:28:21.000Z</published>
    <updated>2023-06-08T06:26:43.567Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æƒ³åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ªè‡ªå·±çš„ nginx æœåŠ¡ï¼Œé€šè¿‡docker éƒ¨ç½²æœ€æ–¹ä¾¿ã€‚ä¹‹å‰ä¹Ÿå‘å¸ƒè¿‡è‡ªå·±çš„dockeré•œåƒï¼Œä½†æ˜¯æ—¶é—´é•¿äº†è€æ˜¯å¿˜è®°å…·ä½“çš„å‘½ä»¤æ˜¯å•¥ï¼Œè¿™é‡Œåšä¸€ä¸ªç¬”è®°è®°å½•ä¸‹ã€‚  </p><h2 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h2><p><code>docker cli</code> æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥å®Œæˆæ„å»º\å‘å¸ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build <span class="comment"># æ„å»ºé•œåƒ</span></span><br><span class="line">docker pull/push <span class="comment"># æ‹‰å–/æ¨é€é•œåƒ</span></span><br></pre></td></tr></table></figure><p>æ•´ä½“æµç¨‹å‚è€ƒä¸‹å›¾ï¼š  </p><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230228143743.png?x-oss-process=image/resize,w_800" alt="dockeræ„å»ºå‘å¸ƒæµç¨‹"></p><h3 id="docker-build-æ„å»ºé•œåƒ"><a href="#docker-build-æ„å»ºé•œåƒ" class="headerlink" title="docker build æ„å»ºé•œåƒ"></a>docker build æ„å»ºé•œåƒ</h3><p>é¦–å…ˆå‘½ä»¤æ ¼å¼<a href="https://docs.docker.com/engine/reference/commandline/build/" target="_blank" rel="noopener">æ¥è‡ªæ–‡æ¡£</a>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [OPTIONS] PATH | URL | -</span><br></pre></td></tr></table></figure><p><code>docker build</code>æ˜¯åˆ©ç”¨ Dockerfile å†…çš„æŒ‡ä»¤æ¥æ„å»ºé•œåƒã€‚é€šå¸¸æˆ‘ä»¬ä¼šæŠŠ Dockerfile ä¹ŸåŠ å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œæ‰€ä»¥å¯¹é•œåƒçš„ä¿®æ”¹æ“ä½œä¹Ÿä¼šæœ‰è®°å½•ï¼Œè¿™ç›¸æ¯” <code>docker commit</code>çš„é»‘ç®±æ“ä½œå¥½å¾ˆå¤šã€‚Dockerfile å°±ä¸ç»†è®²äº†ã€‚</p><a id="more"></a><p>ä¸‹é¢å°±ä»¥å‘å¸ƒä¸€ä¸ªè‡ªå®šä¹‰é…ç½®çš„ nginx é•œåƒä¸ºä¾‹å­ï¼Œè®°å½•ä¸€ä¸‹æ“ä½œæ­¥éª¤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir nginx &amp;&amp; <span class="built_in">cd</span> nginx</span><br><span class="line">vi Dockerfile</span><br><span class="line">```  </span><br><span class="line">è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š</span><br><span class="line">![](https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230228145132.png?x-oss-process=image/resize,w_800)  </span><br><span class="line"></span><br><span class="line">æ„å»ºé•œåƒï¼š</span><br><span class="line">```bash</span><br><span class="line">docker build -t lilong7676/nginx:v1 .</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰“æ ‡ç­¾ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker tag <span class="built_in">local</span>-image:tagname new-repo:tagname</span><br><span class="line"><span class="comment"># å³</span></span><br><span class="line">docker tag nginx:v1 lilong7676/nginx:v1</span><br></pre></td></tr></table></figure><p>æ„å»ºå®Œæˆåï¼ŒæŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ‰“ä¸Šäº†æ ‡ç­¾v1ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image list</span><br></pre></td></tr></table></figure><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230228145327.png?x-oss-process=image/resize,w_800" alt></p><h2 id="å‘å¸ƒé•œåƒ"><a href="#å‘å¸ƒé•œåƒ" class="headerlink" title="å‘å¸ƒé•œåƒ"></a>å‘å¸ƒé•œåƒ</h2><p>ç™»é™† <a href="https://hub.docker.com/" target="_blank" rel="noopener">docker hub</a>ï¼Œåˆ›å»ºä»“åº“<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230228150507.png?x-oss-process=image/resize,w_800" alt></p><p>å‘å¸ƒé•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push lilong7676/nginx:v1</span><br></pre></td></tr></table></figure><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230228151436.png?x-oss-process=image/resize,w_800" alt>  </p><p>docker hubæŸ¥çœ‹ï¼š</p><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230228151455.png?x-oss-process=image/resize,w_800" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æƒ³åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ªè‡ªå·±çš„ nginx æœåŠ¡ï¼Œé€šè¿‡docker éƒ¨ç½²æœ€æ–¹ä¾¿ã€‚ä¹‹å‰ä¹Ÿå‘å¸ƒè¿‡è‡ªå·±çš„dockeré•œåƒï¼Œä½†æ˜¯æ—¶é—´é•¿äº†è€æ˜¯å¿˜è®°å…·ä½“çš„å‘½ä»¤æ˜¯å•¥ï¼Œè¿™é‡Œåšä¸€ä¸ªç¬”è®°è®°å½•ä¸‹ã€‚  &lt;/p&gt;
&lt;h2 id=&quot;æ„å»ºé•œåƒ&quot;&gt;&lt;a href=&quot;#æ„å»ºé•œåƒ&quot; class=&quot;headerlink&quot; title=&quot;æ„å»ºé•œåƒ&quot;&gt;&lt;/a&gt;æ„å»ºé•œåƒ&lt;/h2&gt;&lt;p&gt;&lt;code&gt;docker cli&lt;/code&gt; æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥å®Œæˆæ„å»º\å‘å¸ƒï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker build &lt;span class=&quot;comment&quot;&gt;# æ„å»ºé•œåƒ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;docker pull/push &lt;span class=&quot;comment&quot;&gt;# æ‹‰å–/æ¨é€é•œåƒ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;æ•´ä½“æµç¨‹å‚è€ƒä¸‹å›¾ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230228143743.png?x-oss-process=image/resize,w_800&quot; alt=&quot;dockeræ„å»ºå‘å¸ƒæµç¨‹&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;docker-build-æ„å»ºé•œåƒ&quot;&gt;&lt;a href=&quot;#docker-build-æ„å»ºé•œåƒ&quot; class=&quot;headerlink&quot; title=&quot;docker build æ„å»ºé•œåƒ&quot;&gt;&lt;/a&gt;docker build æ„å»ºé•œåƒ&lt;/h3&gt;&lt;p&gt;é¦–å…ˆå‘½ä»¤æ ¼å¼&lt;a href=&quot;https://docs.docker.com/engine/reference/commandline/build/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ¥è‡ªæ–‡æ¡£&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker build [OPTIONS] PATH | URL | -&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;docker build&lt;/code&gt;æ˜¯åˆ©ç”¨ Dockerfile å†…çš„æŒ‡ä»¤æ¥æ„å»ºé•œåƒã€‚é€šå¸¸æˆ‘ä»¬ä¼šæŠŠ Dockerfile ä¹ŸåŠ å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œæ‰€ä»¥å¯¹é•œåƒçš„ä¿®æ”¹æ“ä½œä¹Ÿä¼šæœ‰è®°å½•ï¼Œè¿™ç›¸æ¯” &lt;code&gt;docker commit&lt;/code&gt;çš„é»‘ç®±æ“ä½œå¥½å¾ˆå¤šã€‚Dockerfile å°±ä¸ç»†è®²äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç¼–è¯‘å¹¶è¿è¡Œ Chrome Devtools Frontend</title>
    <link href="https://lilong7676.github.io/2023/01/12/javascript/%E7%BC%96%E8%AF%91%E5%B9%B6%E8%BF%90%E8%A1%8C-Chrome-Devtools-Frontend/"/>
    <id>https://lilong7676.github.io/2023/01/12/javascript/ç¼–è¯‘å¹¶è¿è¡Œ-Chrome-Devtools-Frontend/</id>
    <published>2023-01-12T01:59:51.000Z</published>
    <updated>2023-06-08T06:26:43.567Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h4 id="Chrome-DevTools-å·¥ä½œåŸç†ç®€å•ä»‹ç»"><a href="#Chrome-DevTools-å·¥ä½œåŸç†ç®€å•ä»‹ç»" class="headerlink" title="Chrome DevTools å·¥ä½œåŸç†ç®€å•ä»‹ç»"></a>Chrome DevTools å·¥ä½œåŸç†ç®€å•ä»‹ç»</h4></blockquote><p>Devtools ä¸åªæ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æŒ‰F12æ‰€æ‰“å¼€çš„è°ƒè¯•ç•Œé¢ï¼Œå®ƒæ˜¯ Chromium çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ Electron ä¸­ä¹Ÿæœ‰é›†æˆã€‚  </p><p>Devtools ä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼š  </p><ul><li><a href="https://github.com/ChromeDevTools/devtools-frontend" target="_blank" rel="noopener">Frontend</a>: è°ƒè¯•å™¨å‰ç«¯ï¼Œé»˜è®¤ç”± Chromium å†…æ ¸å±‚é›†æˆï¼ŒDevTools Frontend æ˜¯ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œå°±æ˜¯ JS + CSS + HTML ç»„æˆçš„ï¼›</li><li><a href="https://github.com/ChromeDevTools/devtools-frontend/tree/main/v8" target="_blank" rel="noopener">Backend</a>: è°ƒè¯•å™¨åç«¯ï¼Œå¹¿ä¹‰ä¸Šä¸»è¦ç”± Chromiumã€V8 æˆ– Node.js(v8)æä¾›ï¼Œç”¨æ¥ä¸ Frontend è¿æ¥ä¸é€šä¿¡;</li><li><a href="https://chromedevtools.github.io/devtools-protocol/" target="_blank" rel="noopener">Protocol</a>: é€šä¿¡åè®®,è°ƒè¯•å™¨å‰ç«¯å’Œåç«¯é€šè¿‡æ­¤åè®®é€šä¿¡ï¼Œåè®®éµå¾ª <a href="https://www.jianshu.com/p/49cd5c9a1664" target="_blank" rel="noopener">JSON RPC2.0</a> è§„èŒƒ;</li><li><a href="https://github.com/ChromeDevTools/devtools-frontend/blob/b29da32422767c87749ca8132c2c0c8f378da6d7/front_end/core/sdk/Connections.ts#L13" target="_blank" rel="noopener">Connection</a>: è¿æ¥å±‚ï¼Œç›®å‰æœ‰ <code>WebSocketConnection</code>ã€<code>StubConnection</code>ã€<code>MainConnection</code> ä¸‰ç§è¿æ¥æ–¹å¼ï¼ŒæŸ¥çœ‹å…¶ä»–<a href="https://zhaomenghuan.js.org/blog/chrome-devtools-frontend-analysis-of-principle.html#devtools-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" target="_blank" rel="noopener">èµ„æ–™</a>ï¼Œä¹Ÿæœ‰è¯´æ˜¯æ¶ˆæ¯é€šé“ï¼Œå³ Embedder Channelã€WebSocket Channelã€Chrome Extensions Channelã€USB/ADB Channelï¼Œä½†æ˜¯æˆ‘åœ¨å½“å‰çš„ç‰ˆæœ¬æ²¡æœ‰æ‰¾åˆ°è¿™éƒ¨åˆ†ä»£ç ï¼›  </li></ul><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112104133.png?x-oss-process=image/resize,w_800" alt="devtools å›¾ç¤º"></p><a id="more"></a><blockquote><h4 id="Devtools-Frontend-ç¼–è¯‘"><a href="#Devtools-Frontend-ç¼–è¯‘" class="headerlink" title="Devtools Frontend ç¼–è¯‘"></a>Devtools Frontend ç¼–è¯‘</h4></blockquote><ol><li><p>clone devtools-frontend æºç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:ChromeDevTools/devtools-frontend.git</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… depot_tools</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¿…é¡»å®‰è£…æ­¤å·¥å…·æ‰èƒ½ç¼–è¯‘ devtools-frontend</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ depot_tools æºç </span></span><br><span class="line">$ git <span class="built_in">clone</span> https://chromium.googlesource.com/chromium/tools/depot_tools.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å…¶æ·»åŠ åˆ°æœ¬æœºç¯å¢ƒå˜é‡ä¸­</span></span><br><span class="line">$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/path/to/depot_tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç¯å¢ƒå˜é‡ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure></li><li><p>åªæ£€å‡º DevTools frontend çš„ä»£ç ï¼Œå› ä¸º DevTools Frontend å¯ç‹¬ç«‹äº Chromium ä½œä¸ºç‹¬ç«‹é¡¹ç›®æ„å»ºï¼Œå¹¶ä¸”å¦‚æœä¸æ‰§è¡Œè¿™ä¸€æ­¥ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ï¼š<code>gn.py: Could not find checkout in any parent of the current path.This must be run inside a checkout.</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir devtools</span><br><span class="line">$ <span class="built_in">cd</span> devtools</span><br><span class="line">$ fetch devtools-frontend</span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œä¸Šä¸€æ­¥å¯èƒ½ä¼šç”±äºç½‘ç»œé—®é¢˜å¯¼è‡´ git ç›¸å…³æ“ä½œå¤±è´¥ï¼Œå¯é€šè¿‡é…ç½® git å’Œç»ˆç«¯ä»£ç†è§£å†³</span></span><br></pre></td></tr></table></figure></li><li><p>æ„å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> devtools-frontend</span><br><span class="line">$ gn gen out/Default</span><br><span class="line">$ autoninja -C out/Default</span><br><span class="line"><span class="comment"># æ„å»ºäº§ç‰©åœ¨ devtools-frontend/devtools/devtools-frontend/out/Default æ–‡ä»¶å¤¹ä¸­</span></span><br></pre></td></tr></table></figure></li></ol><blockquote><h4 id="è¿è¡Œ-devtools-frontend-äº§ç‰©"><a href="#è¿è¡Œ-devtools-frontend-äº§ç‰©" class="headerlink" title="è¿è¡Œ devtools frontend äº§ç‰©"></a>è¿è¡Œ devtools frontend äº§ç‰©</h4></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥åˆ°æ„å»ºäº§ç‰©ç›®å½•</span></span><br><span class="line">$ <span class="built_in">cd</span> out/Default/gen/front_end</span><br><span class="line"></span><br><span class="line"><span class="comment"># serve æ„å»ºäº§ç‰©</span></span><br><span class="line">$ npx http-server</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ„å»ºäº§ç‰©ç›®å½•ï¼Œè¿™å‡ ä¸ª html å…¶å®å°±æ˜¯è°ƒè¯•å‰ç«¯é¢æ¿ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112111618.png?x-oss-process=image/resize,w_800,h_600" alt="æ„å»ºäº§ç‰©ç›®å½•"></p><p>æ¯”å¦‚æ‰“å¼€ <code>http://127.0.0.1:8080/devtools_app.html</code>ï¼Œå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ web é¡µé¢è°ƒè¯•ç•Œé¢ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112111832.png?x-oss-process=image/resize,w_800" alt>  </p><p>ä¹Ÿå¯ä»¥è‡ªå·±å°è¯•æ‰“å¼€å…¶ä»–htmlï¼Œå¦‚ <code>http://127.0.0.1:8080/node_app.html</code>ï¼Œ<code>http://127.0.0.1:8080/inspector.html</code>ç­‰  </p><blockquote><h4 id="ç»“åˆ-node-inspect-æ¥è°ƒè¯•-nodejs-ä»£ç "><a href="#ç»“åˆ-node-inspect-æ¥è°ƒè¯•-nodejs-ä»£ç " class="headerlink" title="ç»“åˆ node inspect æ¥è°ƒè¯• nodejs ä»£ç "></a>ç»“åˆ node inspect æ¥è°ƒè¯• nodejs ä»£ç </h4></blockquote><p>å¦‚<a href="https://lilong7676.github.io/2023/01/10/uncategorized/%E4%BD%BF%E7%94%A8-ChromeRemoteInterface-%E8%B0%83%E8%AF%95-nodejs-%E4%BB%A3%E7%A0%81/#%E5%87%86%E5%A4%87%E5%BE%85%E8%B0%83%E8%AF%95%E7%9A%84-nodejs-%E5%AE%9E%E4%BE%8B">ä¸Šä¸€ç¯‡</a>æ‰€è®²ï¼Œå…ˆå‡†å¤‡å¸¦è°ƒè¯•çš„ nodejs å®ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node --inspect=9222 <span class="keyword">for</span>-inspect.js</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—® <code>http://localhost:9222/json</code> è·å–åˆ° <code>devtoolsFrontendUrl</code>ï¼Œç±»ä¼¼äº <code>devtools://devtools/bundled/js_app.html?experiments=true&amp;v8only=true&amp;ws=localhost:9222/8c4626a1-2903-4da8-9759-5de3c74c3a35</code>  </p><p>åªéœ€è¦å°†å…¶ <code>query</code> å‚æ•°æ‹¼æ¥åˆ° <code>http://127.0.0.1:8080/***.html</code>åé¢å³å¯ï¼Œæ‹¼æ¥åç±»ä¼¼äº <code>http://127.0.0.1:8080/inspector.html?experiments=true&amp;v8only=true&amp;ws=localhost:9222/8c4626a1-2903-4da8-9759-5de3c74c3a35</code>ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åçš„æ•ˆæœå¦‚å›¾ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112135350.png?x-oss-process=image/resize,w_800" alt></p><blockquote><h4 id="ä»-devtools-ä¸­æŸ¥çœ‹-Chrome-Devtools-Protocol-ğŸ§"><a href="#ä»-devtools-ä¸­æŸ¥çœ‹-Chrome-Devtools-Protocol-ğŸ§" class="headerlink" title="ä» devtools ä¸­æŸ¥çœ‹ Chrome Devtools Protocol ğŸ§"></a>ä» devtools ä¸­æŸ¥çœ‹ Chrome Devtools Protocol ğŸ§</h4></blockquote><p>åœ¨ <code>Settings -&gt; Experiments</code> ä¸­æ‰“å¼€ <code>Protocol Monitor</code> é€‰é¡¹ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112140245.png?x-oss-process=image/resize,w_800" alt="æ‰“å¼€ Protocol Monitor é€‰é¡¹"></p><p>æ˜¾ç¤º <code>Protocol Monitor</code>ï¼š<img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112140441.png?x-oss-process=image/resize,w_800" alt></p><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112141045.png?x-oss-process=image/resize,w_800" alt="CDP"></p><blockquote><h4 id="å®šåˆ¶è°ƒè¯•é¢æ¿çš„æ˜¾ç¤ºï¼Œåªéœ€è¦-consoleã€sourceã€network-é¢æ¿"><a href="#å®šåˆ¶è°ƒè¯•é¢æ¿çš„æ˜¾ç¤ºï¼Œåªéœ€è¦-consoleã€sourceã€network-é¢æ¿" class="headerlink" title="å®šåˆ¶è°ƒè¯•é¢æ¿çš„æ˜¾ç¤ºï¼Œåªéœ€è¦ consoleã€sourceã€network é¢æ¿"></a>å®šåˆ¶è°ƒè¯•é¢æ¿çš„æ˜¾ç¤ºï¼Œåªéœ€è¦ consoleã€sourceã€network é¢æ¿</h4></blockquote><blockquote><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è‡ªå®šä¹‰è°ƒè¯•ç•Œé¢éœ€è¦æ˜¾ç¤ºå“ªäº›é¢æ¿ã€‚æ¯”å¦‚æˆ‘åªéœ€è¦ consoleã€sourceã€network è¿™ä¸‰ä¸ªé¢æ¿ï¼Œä¸éœ€è¦å…¶ä»–çš„ï¼Œè€Œä¸”å…¨éƒ¨é›†æˆä¹Ÿä¸å¤ªç°å®ï¼Œå› ä¸ºåŠ è½½é€Ÿåº¦å¤ªæ…¢ã€‚  </p></blockquote><p>è§‚å¯Ÿå…¶äº§ç‰©çš„jsï¼Œè¿™é‡Œä»¥ <code>inspector.html</code> è§£é‡Šï¼š</p><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112165907.png?x-oss-process=image/resize,w_800" alt="inspector.html"></p><p>è¯´æ˜å…¶å…¥å£ js ä¸º <code>./entrypoints/inspector/inspector.ts</code>ï¼ŒæŸ¥çœ‹å…¶åŸå§‹ä»£ç ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112172446.png?x-oss-process=image/resize,w_800" alt><br>è¿™é‡Œèƒ½çœ‹å‡ºæ¥ï¼Œ<code>inspector_app</code> ç›¸æ¯” <code>devtools_app</code> å¢åŠ äº† <code>screencast</code> é¢æ¿çš„åŠŸèƒ½ã€‚  <img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112165907.png?x-oss-process%3Dimage%2Fresize%2Cw_800" alt="Alt text"><br>æ‰€ä»¥æˆ‘ä»¬å¤§è‡´å¾—å‡ºç»“è®ºï¼Œå¦‚æœæƒ³è¦å®šåˆ¶è°ƒè¯•é¢æ¿çš„ç°å®ï¼Œåªéœ€è¦ä¿®æ”¹å¯¹åº” <code>entrypoints/***_app</code> ä¸‹çš„ä»£ç å³å¯ã€‚</p><blockquote><h4 id="æ”¹é€ -devtools-app"><a href="#æ”¹é€ -devtools-app" class="headerlink" title="æ”¹é€  devtools_app"></a>æ”¹é€  devtools_app</h4></blockquote><p>é€šè¿‡æŸ¥çœ‹ devtools_app çš„ç•Œé¢ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦ consoleã€sourceã€network ä¸‰ä¸ªé¢æ¿ï¼Œæ‰€ä»¥éœ€è¦ç§»é™¤å¤šä½™çš„è°ƒè¯•é¢æ¿:<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112173848.png?x-oss-process=image/resize,w_800" alt></p><h5 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h5><ul><li><a href="https://www.51cto.com/article/716801.html" target="_blank" rel="noopener">ç©è½¬ Chrome DevToolsï¼Œå®šåˆ¶è‡ªå·±çš„è°ƒè¯•å·¥å…·</a></li><li><a href="https://zhaomenghuan.js.org/blog/chrome-devtools-frontend-analysis-of-principle.html#%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E5%8F%8A%E7%BC%96%E8%AF%91" target="_blank" rel="noopener">Chrome DevTools Frontend è¿è¡ŒåŸç†æµ…æ</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;h4 id=&quot;Chrome-DevTools-å·¥ä½œåŸç†ç®€å•ä»‹ç»&quot;&gt;&lt;a href=&quot;#Chrome-DevTools-å·¥ä½œåŸç†ç®€å•ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;Chrome DevTools å·¥ä½œåŸç†ç®€å•ä»‹ç»&quot;&gt;&lt;/a&gt;Chrome DevTools å·¥ä½œåŸç†ç®€å•ä»‹ç»&lt;/h4&gt;&lt;/blockquote&gt;
&lt;p&gt;Devtools ä¸åªæ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æŒ‰F12æ‰€æ‰“å¼€çš„è°ƒè¯•ç•Œé¢ï¼Œå®ƒæ˜¯ Chromium çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ Electron ä¸­ä¹Ÿæœ‰é›†æˆã€‚  &lt;/p&gt;
&lt;p&gt;Devtools ä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ChromeDevTools/devtools-frontend&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Frontend&lt;/a&gt;: è°ƒè¯•å™¨å‰ç«¯ï¼Œé»˜è®¤ç”± Chromium å†…æ ¸å±‚é›†æˆï¼ŒDevTools Frontend æ˜¯ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œå°±æ˜¯ JS + CSS + HTML ç»„æˆçš„ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ChromeDevTools/devtools-frontend/tree/main/v8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Backend&lt;/a&gt;: è°ƒè¯•å™¨åç«¯ï¼Œå¹¿ä¹‰ä¸Šä¸»è¦ç”± Chromiumã€V8 æˆ– Node.js(v8)æä¾›ï¼Œç”¨æ¥ä¸ Frontend è¿æ¥ä¸é€šä¿¡;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://chromedevtools.github.io/devtools-protocol/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Protocol&lt;/a&gt;: é€šä¿¡åè®®,è°ƒè¯•å™¨å‰ç«¯å’Œåç«¯é€šè¿‡æ­¤åè®®é€šä¿¡ï¼Œåè®®éµå¾ª &lt;a href=&quot;https://www.jianshu.com/p/49cd5c9a1664&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;JSON RPC2.0&lt;/a&gt; è§„èŒƒ;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ChromeDevTools/devtools-frontend/blob/b29da32422767c87749ca8132c2c0c8f378da6d7/front_end/core/sdk/Connections.ts#L13&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Connection&lt;/a&gt;: è¿æ¥å±‚ï¼Œç›®å‰æœ‰ &lt;code&gt;WebSocketConnection&lt;/code&gt;ã€&lt;code&gt;StubConnection&lt;/code&gt;ã€&lt;code&gt;MainConnection&lt;/code&gt; ä¸‰ç§è¿æ¥æ–¹å¼ï¼ŒæŸ¥çœ‹å…¶ä»–&lt;a href=&quot;https://zhaomenghuan.js.org/blog/chrome-devtools-frontend-analysis-of-principle.html#devtools-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;èµ„æ–™&lt;/a&gt;ï¼Œä¹Ÿæœ‰è¯´æ˜¯æ¶ˆæ¯é€šé“ï¼Œå³ Embedder Channelã€WebSocket Channelã€Chrome Extensions Channelã€USB/ADB Channelï¼Œä½†æ˜¯æˆ‘åœ¨å½“å‰çš„ç‰ˆæœ¬æ²¡æœ‰æ‰¾åˆ°è¿™éƒ¨åˆ†ä»£ç ï¼›  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230112104133.png?x-oss-process=image/resize,w_800&quot; alt=&quot;devtools å›¾ç¤º&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://lilong7676.github.io/categories/javascript/"/>
    
    
      <category term="ChromeDevTools" scheme="https://lilong7676.github.io/tags/ChromeDevTools/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ ChromeRemoteInterface è°ƒè¯• nodejs ä»£ç </title>
    <link href="https://lilong7676.github.io/2023/01/10/javascript/%E4%BD%BF%E7%94%A8-ChromeRemoteInterface-%E8%B0%83%E8%AF%95-nodejs-%E4%BB%A3%E7%A0%81/"/>
    <id>https://lilong7676.github.io/2023/01/10/javascript/ä½¿ç”¨-ChromeRemoteInterface-è°ƒè¯•-nodejs-ä»£ç /</id>
    <published>2023-01-10T06:59:29.000Z</published>
    <updated>2023-06-08T06:26:43.566Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘åœ¨è°ƒç ”å¦‚ä½•è¿œç¨‹è°ƒè¯•ä¸€ä¸ª nodejs è¿›ç¨‹ï¼Œå¤§è‡´è°ƒç ”è·¯å¾„æ˜¯ Chome DevTolls -&gt; Chrome debugging protocol -&gt; chrome-remote-interfaceï¼Œæœ¬æ–‡é‡ç‚¹ä»‹ç»ä¸‹ chrome-remote-interface çš„ç®€å•ä½¿ç”¨ã€‚ </p></blockquote><p>æ ¹æ®å…¶<a href="https://github.com/cyrus-and/chrome-remote-interface" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼Œè¿™ä¸ªå·¥å…·ä¸»è¦æ˜¯æä¾›ä¸€ä¸ª js apiï¼Œåœ¨è¿æ¥åˆ°å¯¹åº”çš„æœåŠ¡ç«¯ï¼ˆè¦è°ƒè¯•çš„ç«¯ï¼‰åï¼Œé€šè¿‡ Chrome Debugging Protocol ä¸ä¹‹äº¤äº’ã€‚  </p><p>æ‰€ä»¥å…¶åŸºæœ¬çš„ä½¿ç”¨åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š  </p><ul><li>å¯åŠ¨ nodejs å®ä¾‹ï¼Œå¹¶æ‰“å¼€è°ƒè¯•æ¨¡å¼, eg. <code>node --inspect-brk=9222 for-insepct.js</code></li><li>é€šè¿‡ CDP è¿æ¥åˆ°è¿œç¨‹è°ƒè¯•å®ä¾‹</li><li>é€šè¿‡ CDP Client æ“ä½œè¿œç¨‹è°ƒè¯•å®ä¾‹</li></ul><a id="more"></a><h4 id="å‡†å¤‡å¾…è°ƒè¯•çš„-nodejs-å®ä¾‹"><a href="#å‡†å¤‡å¾…è°ƒè¯•çš„-nodejs-å®ä¾‹" class="headerlink" title="å‡†å¤‡å¾…è°ƒè¯•çš„ nodejs å®ä¾‹"></a>å‡†å¤‡å¾…è°ƒè¯•çš„ nodejs å®ä¾‹</h4><p>å…ˆæ–°å»º <code>for-inspect.js</code>ï¼Œå¯ä»¥å†™å…¥ä»»æ„å¯æ‰§è¡Œçš„ä»£ç ï¼š  </p><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230111114509.png" alt="for-inspect.js"></p><p>æ‰§è¡Œä»£ç ï¼Œé™„åŠ  <code>--inspect-brk=9222</code> è°ƒè¯•å‚æ•°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node --inspect-brk=9222 <span class="keyword">for</span>-insepct.js</span></span><br></pre></td></tr></table></figure><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230110170510.png" alt="æ‰§è¡Œç»“æœ"><br>æœ‰å…³ inspect-brk å‚æ•°çš„ä½œç”¨å¯ä»¥å‚è€ƒ <a href="https://nodejs.org/en/docs/guides/debugging-getting-started/#command-line-options" target="_blank" rel="noopener">nodeæ–‡æ¡£</a>ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ‰“å¼€è°ƒè¯•æ¨¡å¼ï¼Œå¹¶åœ¨ä»£ç é¦–è¡Œæ–­ç‚¹æ‰§è¡Œï¼Œé»˜è®¤å®ä¾‹è°ƒè¯•åœ°å€ä¸º localhost:9229<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230110171113.png" alt="inspect-brk å‚æ•°"> </p><p>æ­¤æ—¶ï¼Œnodejs å·²ç»åœ¨ <code>localhost:9222</code> ä¸Šå¯åŠ¨äº†è°ƒè¯•å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡è®¿é—® <code>http://localhost:9222/json</code> æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[ &#123;</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"node.js instance"</span>,</span><br><span class="line">  <span class="attr">"devtoolsFrontendUrl"</span>: <span class="string">"devtools://devtools/bundled/js_app.html?experiments=true&amp;v8only=true&amp;ws=localhost:9222/4d7174b7-e4cf-4d60-84c5-80f3eed2477d"</span>,</span><br><span class="line">  <span class="attr">"devtoolsFrontendUrlCompat"</span>: <span class="string">"devtools://devtools/bundled/inspector.html?experiments=true&amp;v8only=true&amp;ws=localhost:9222/4d7174b7-e4cf-4d60-84c5-80f3eed2477d"</span>,</span><br><span class="line">  <span class="attr">"faviconUrl"</span>: <span class="string">"https://nodejs.org/static/images/favicons/favicon.ico"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="string">"4d7174b7-e4cf-4d60-84c5-80f3eed2477d"</span>,</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"for-insepct.js"</span>,</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"node"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"file:///Users/lilonglong/Desktop/long_git/chrome-devtools-analysis/for-insepct.js"</span>,</span><br><span class="line">  <span class="attr">"webSocketDebuggerUrl"</span>: <span class="string">"ws://localhost:9222/4d7174b7-e4cf-4d60-84c5-80f3eed2477d"</span></span><br><span class="line">&#125; ]</span><br></pre></td></tr></table></figure><p>å¯é€šè¿‡ Chrome ç›´æ¥è®¿é—® <code>devtoolsFrontendUrl</code>:<img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230110172257.png" alt="Chrome è®¿é—® devtoolsFrontendUrl">  </p><p>å½“ç„¶ï¼Œå¯ä»¥é€šè¿‡ä¸Šé¢çš„ Chrome æ¥è°ƒè¯• nodejs ä»£ç ï¼Œæ‰€ä»¥æ­¤æ–¹æ¡ˆä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯å¦‚ä½•é€šè¿‡ä»£ç æ¥è¿œç¨‹è°ƒè¯• nodejs ä»£ç ã€‚</p><h4 id="é€šè¿‡-chrome-remote-interface-è¿œç¨‹è°ƒè¯•-nodejs"><a href="#é€šè¿‡-chrome-remote-interface-è¿œç¨‹è°ƒè¯•-nodejs" class="headerlink" title="é€šè¿‡ chrome-remote-interface è¿œç¨‹è°ƒè¯• nodejs"></a>é€šè¿‡ chrome-remote-interface è¿œç¨‹è°ƒè¯• nodejs</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cdp.js</span></span><br><span class="line"><span class="keyword">const</span> CDP = <span class="built_in">require</span>(<span class="string">"chrome-remote-interface"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡é»˜è®¤çš„è¿æ¥é…ç½®ï¼Œè¿æ¥åˆ°å¯¹åº”çš„ è°ƒè¯•å®ä¾‹ï¼ˆinspector agentï¼‰</span></span><br><span class="line">CDP(<span class="keyword">async</span> (client) =&gt; &#123;</span><br><span class="line">  <span class="comment">// è¿æ¥æˆåŠŸï¼Œé€šè¿‡ CDP client å³å¯æ“ä½œè°ƒè¯•å®ä¾‹</span></span><br><span class="line">  <span class="keyword">const</span> &#123; Debugger, Runtime, Network &#125; = client;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ç›‘å¬ scriptParsed äº‹ä»¶ï¼Œæ‹¿åˆ° script source code</span></span><br><span class="line">    Debugger.on(<span class="string">"scriptParsed"</span>, <span class="keyword">async</span> (params) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; scriptId, url &#125; = params;</span><br><span class="line">      <span class="comment">// console.log(`scriptId: $&#123;scriptId&#125;, url: $&#123;url&#125;`);</span></span><br><span class="line">      <span class="keyword">if</span> (url.startsWith(<span class="string">"file://"</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> source = <span class="keyword">await</span> client.Debugger.getScriptSource(&#123; scriptId &#125;);</span><br><span class="line">        <span class="comment">// æ‰“å°è·å–åˆ°çš„ script æºç </span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"script source"</span>, source);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬è¿›å…¥åˆ°æ–­ç‚¹äº‹ä»¶</span></span><br><span class="line">    Debugger.on(<span class="string">"paused"</span>, (pausedEvent) =&gt; &#123;</span><br><span class="line">      <span class="comment">// pausedEvent é‡Œé¢åŒ…å«å½“å‰æ–­ç‚¹çš„ä½ç½®ä»¥åŠ callFrames ä¿¡æ¯ç­‰</span></span><br><span class="line">      <span class="comment">// console.log('pausedEvent ', pausedEvent);</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒè¯•å®ä¾‹å¦‚æœåœ¨ç­‰å¾…é™„åŠ è°ƒè¯•å™¨ï¼Œåˆ™å…ˆç»§ç»­è¿è¡Œè°ƒè¯•å®ä¾‹</span></span><br><span class="line">    <span class="keyword">await</span> Runtime.runIfWaitingForDebugger();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯·æ±‚å…è®¸ä½¿ç”¨ agent çš„ Debugger åŠŸèƒ½</span></span><br><span class="line">    <span class="keyword">await</span> Debugger.enable();</span><br><span class="line">    <span class="comment">// è¯·æ±‚å…è®¸ä½¿ç”¨ agent çš„ Runtime åŠŸèƒ½</span></span><br><span class="line">    <span class="keyword">await</span> Runtime.enable();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try &#123;</span></span><br><span class="line">    <span class="comment">//   // ç½‘ç»œè¯·æ±‚åŸŸï¼Œè¿™é‡Œæ³¨é‡Šçš„åŸå› æ˜¯ nodejs v8 ä¸æ”¯æŒè°ƒè¯• Network åŸŸ</span></span><br><span class="line">    <span class="comment">//   await Network.enable(&#123; maxPostDataSize: 65536 &#125;);</span></span><br><span class="line">    <span class="comment">// &#125; catch (error) &#123;</span></span><br><span class="line">    <span class="comment">//   console.error('Network attach failed', error);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿œç¨‹æ‰§è¡Œä»£ç </span></span><br><span class="line">    <span class="keyword">const</span> testValue = <span class="keyword">await</span> Runtime.evaluate(&#123;</span><br><span class="line">      expression: <span class="string">"eval(1 + 1)"</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"evaluate result"</span>, testValue);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    client.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).on(<span class="string">"error"</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20230111113918.png" alt="node cdp.js"></p><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul><li><a href="https://chromedevtools.github.io/devtools-protocol/v8/" target="_blank" rel="noopener">v8 CDP æ–‡æ¡£</a></li><li><a href="https://blog.cloudflare.com/better-workers-debugging-with-a-network-panel/" target="_blank" rel="noopener">Cloudflare Worker Debugger è®¾è®¡</a></li><li><a href="https://www.jianshu.com/p/49cd5c9a1664" target="_blank" rel="noopener">JSON-RPC æ˜¯ä»€ä¹ˆ</a></li><li><a href="https://nodejs.org/en/docs/guides/debugging-getting-started/#command-line-options" target="_blank" rel="noopener">node debugging guide</a></li><li><a href="https://garnik.medium.com/http-inspector-a-devtools-network-tab-for-node-js-process-5a008d17bf28" target="_blank" rel="noopener">http-inspector â€” a DevTools Network tab for Node.js process</a></li><li><a href="https://github.com/nodejs/diagnostics/issues/75" target="_blank" rel="noopener">æœ‰å…³ node ä¸æ”¯æŒè°ƒè¯• network çš„è®¨è®º</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘åœ¨è°ƒç ”å¦‚ä½•è¿œç¨‹è°ƒè¯•ä¸€ä¸ª nodejs è¿›ç¨‹ï¼Œå¤§è‡´è°ƒç ”è·¯å¾„æ˜¯ Chome DevTolls -&amp;gt; Chrome debugging protocol -&amp;gt; chrome-remote-interfaceï¼Œæœ¬æ–‡é‡ç‚¹ä»‹ç»ä¸‹ chrome-remote-interface çš„ç®€å•ä½¿ç”¨ã€‚ &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ ¹æ®å…¶&lt;a href=&quot;https://github.com/cyrus-and/chrome-remote-interface&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ–‡æ¡£&lt;/a&gt;ï¼Œè¿™ä¸ªå·¥å…·ä¸»è¦æ˜¯æä¾›ä¸€ä¸ª js apiï¼Œåœ¨è¿æ¥åˆ°å¯¹åº”çš„æœåŠ¡ç«¯ï¼ˆè¦è°ƒè¯•çš„ç«¯ï¼‰åï¼Œé€šè¿‡ Chrome Debugging Protocol ä¸ä¹‹äº¤äº’ã€‚  &lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å…¶åŸºæœ¬çš„ä½¿ç”¨åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯åŠ¨ nodejs å®ä¾‹ï¼Œå¹¶æ‰“å¼€è°ƒè¯•æ¨¡å¼, eg. &lt;code&gt;node --inspect-brk=9222 for-insepct.js&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€šè¿‡ CDP è¿æ¥åˆ°è¿œç¨‹è°ƒè¯•å®ä¾‹&lt;/li&gt;
&lt;li&gt;é€šè¿‡ CDP Client æ“ä½œè¿œç¨‹è°ƒè¯•å®ä¾‹&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://lilong7676.github.io/categories/javascript/"/>
    
    
      <category term="ChromeDevTools" scheme="https://lilong7676.github.io/tags/ChromeDevTools/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ babel å®ç°ä¸€ä¸ªè‡ªåˆ›çš„ js è¯­æ³•</title>
    <link href="https://lilong7676.github.io/2022/12/09/javascript/%E4%BD%BF%E7%94%A8-babel-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%87%AA%E5%88%9B%E7%9A%84-js-%E8%AF%AD%E6%B3%95/"/>
    <id>https://lilong7676.github.io/2022/12/09/javascript/ä½¿ç”¨-babel-å®ç°ä¸€ä¸ªè‡ªåˆ›çš„-js-è¯­æ³•/</id>
    <published>2022-12-09T06:39:26.000Z</published>
    <updated>2023-06-08T06:26:43.566Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç”¨-babel-å®ç°ç”¨-æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°†ä¸ºå‡½æ•°è‡ªåŠ¨åŠ ä¸Šè°ƒç”¨æ—¥å¿—æ‰“å°çš„åŠŸèƒ½"><a href="#ç”¨-babel-å®ç°ç”¨-æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°†ä¸ºå‡½æ•°è‡ªåŠ¨åŠ ä¸Šè°ƒç”¨æ—¥å¿—æ‰“å°çš„åŠŸèƒ½" class="headerlink" title="ç”¨ babel å®ç°ç”¨ @!æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°†ä¸ºå‡½æ•°è‡ªåŠ¨åŠ ä¸Šè°ƒç”¨æ—¥å¿—æ‰“å°çš„åŠŸèƒ½"></a>ç”¨ babel å®ç°ç”¨ <code>@!</code>æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°†ä¸ºå‡½æ•°è‡ªåŠ¨åŠ ä¸Šè°ƒç”¨æ—¥å¿—æ‰“å°çš„åŠŸèƒ½</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> @! <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">// è½¬åŒ–ä¸º</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'function name:'</span>, <span class="string">'foo'</span>, <span class="string">'date:'</span>, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>æ ¹æ®<a href="https://babeljs.io/docs/en/babel-parser#output" target="_blank" rel="noopener">æ–‡æ¡£</a>å¯çŸ¥è¦åœ¨ <code>packages/babel-parser</code> é‡Œæ‰¾é€»è¾‘</p><p><strong>æ³¨æ„ï¼Œè¯·å…ˆ fork babel æºç </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ babel æºç ç›®å½•é‡Œæ‰§è¡Œ</span></span><br><span class="line">$ make watch <span class="comment"># ç¼–è¯‘å¹¶ watch</span></span><br><span class="line">$ <span class="built_in">cd</span> packages/babel-parse/<span class="built_in">test</span></span><br><span class="line"><span class="comment"># åœ¨ babel-parse é‡Œæ–°å»ºå•å…ƒæµ‹è¯•æ–‡ä»¶ï¼Œç”¨æ¥éªŒè¯é€»è¾‘</span></span><br><span class="line">$ touch <span class="built_in">test</span>-parser.js</span><br></pre></td></tr></table></figure><p>test-parser.js å†…å®¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test-parser.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; parse &#125; <span class="keyword">from</span> <span class="string">"../lib/index.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getParser</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// sourceType å¯èƒ½çš„å€¼ä¸º "script", "module", or "unambiguous"ï¼Œ</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯ unambiguousï¼Œåˆ™ babel ä¼šå°è¯•åˆ¤æ–­ä»£ç ä¸­æ˜¯å¦åŒ…å« import export è¯­å¥æ¥ç¡®å®šå…·ä½“ç±»å‹</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> parse(code, &#123; <span class="attr">sourceType</span>: <span class="string">"module"</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">"æµ‹è¯•è‡ªå®šä¹‰è¯­æ³• @! parse -&gt; ast"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">"should parse"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    expect(getParser(<span class="string">`function @! foo() &#123;&#125;`</span>)()).toMatchSnapshot();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œ jestï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œ jest</span></span><br><span class="line"> $ BABEL_ENV=<span class="built_in">test</span> node_modules/.bin/jest -u packages/babel-parser/<span class="built_in">test</span>/<span class="built_in">test</span>-parser.js</span><br></pre></td></tr></table></figure><p> æ‰§è¡Œç»“æœæŠ¥é”™ä¿¡æ¯ï¼š<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  æµ‹è¯•è‡ªå®šä¹‰è¯­æ³• @@ parse -&gt; ast</span><br><span class="line">    âœ• should parse</span><br><span class="line"></span><br><span class="line">æµ‹è¯•è‡ªå®šä¹‰è¯­æ³• @@ parse -&gt; ast &gt; should parse</span><br><span class="line">    SyntaxError: Unexpected token (1:9)</span><br><span class="line">        at instantiate (/babel-lib/packages/babel-parser/lib/parse-error/credentials.js:27:32)</span><br><span class="line">        at constructor (/babel-lib/packages/babel-parser/lib/parse-error.js:41:41)</span><br><span class="line">        at Parser.raise (/babel-lib/packages/babel-parser/lib/tokenizer/index.js:1062:19)</span><br><span class="line">        at Parser.unexpected (/babel-lib/packages/babel-parser/lib/tokenizer/index.js:1095:16)</span><br><span class="line">        at Parser.parseIdentifierName (/babel-lib/packages/babel-parser/lib/parser/expression.js:1641:18)</span><br><span class="line">        at Parser.parseIdentifier (/babel-lib/packages/babel-parser/lib/parser/expression.js:1624:23)</span><br><span class="line">        at Parser.parseFunctionId (/babel-lib/packages/babel-parser/lib/parser/statement.js:991:79)</span><br><span class="line">        at Parser.parseFunction (/babel-lib/packages/babel-parser/lib/parser/statement.js:961:22)</span><br><span class="line">        at Parser.parseFunctionStatement (/babel-lib/packages/babel-parser/lib/parser/statement.js:603:17)</span><br><span class="line">        at Parser.parseStatementContent (/babel-lib/packages/babel-parser/lib/parser/statement.js:272:21) &#123;</span><br><span class="line">      code: <span class="string">'BABEL_PARSER_SYNTAX_ERROR'</span>,</span><br><span class="line">      reasonCode: <span class="string">'UnexpectedToken'</span>,</span><br><span class="line">      loc: Position &#123; line: 1, column: 9, index: 9 &#125;,</span><br><span class="line">      pos: [Getter/Setter]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è§‚å¯Ÿé”™è¯¯ä¿¡æ¯ï¼Œå‘ç°å…³é”®é”™è¯¯ç‚¹åœ¨ <code>parseIdentifierName</code> é‡ŒæŠ¥ <code>unexpected</code> é”™è¯¯ï¼Œä¸‹é¢è°ƒè¯•ä¸‹é€»è¾‘ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/babel-parser/src/parser/expression.ts</span></span><br><span class="line"></span><br><span class="line"> parseIdentifierName(liberal?: boolean): string &#123;</span><br><span class="line">    <span class="keyword">let</span> name: string;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; startLoc, type &#125; = <span class="keyword">this</span>.state;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"identifier value"</span>, <span class="keyword">this</span>.state.value);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"next identifier value"</span>, <span class="keyword">this</span>.lookahead().value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tokenIsKeywordOrIdentifier(type)) &#123;</span><br><span class="line">      name = <span class="keyword">this</span>.state.value;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">this</span>.unexpected();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥é—®é¢˜æ˜¯ babel ä¸è®¤è¯† @! æ ‡è¯†ç¬¦ï¼Œé‚£ä¹ˆå¤„ç†ä¸€ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/babel-parser/src/tokenizer/types.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> tt = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    at: createToken(<span class="string">"@"</span>),</span><br><span class="line">    atEM: createToken(<span class="string">"@!"</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/babel-parser/src/parser/statement.ts</span></span><br><span class="line"></span><br><span class="line"> parseFunction&lt;T extends N.NormalFunction&gt;(</span><br><span class="line">    <span class="keyword">this</span>: Parser,</span><br><span class="line">    node: Undone&lt;T&gt;,</span><br><span class="line">    statement: number = FUNC_NO_FLAGS,</span><br><span class="line">    isAsync: boolean = <span class="literal">false</span>,</span><br><span class="line">  ): T &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    node.generator = <span class="keyword">this</span>.eat(tt.star);</span><br><span class="line">    <span class="comment">// å®ç°è‡ªå®šä¹‰è¯­æ³• @ï¼</span></span><br><span class="line">    node.logThisFunc = <span class="keyword">this</span>.eat(tt.atEM);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œ jest æˆåŠŸ:<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221209155741.png" alt="æ‰§è¡ŒæˆåŠŸ"></p><p>æŸ¥çœ‹ ast ç»“æœï¼ŒlogThisFunc å·²æ ‡è®°ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221209155905.png" alt="æŸ¥çœ‹ ast ç»“æœ"></p><p>// TODO ç¼–å†™æ’ä»¶ï¼Œå®ç°è½¬æ¢é€»è¾‘</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç”¨-babel-å®ç°ç”¨-æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°†ä¸ºå‡½æ•°è‡ªåŠ¨åŠ ä¸Šè°ƒç”¨æ—¥å¿—æ‰“å°çš„åŠŸèƒ½&quot;&gt;&lt;a href=&quot;#ç”¨-babel-å®ç°ç”¨-æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°†ä¸ºå‡½æ•°è‡ªåŠ¨åŠ ä¸Šè°ƒç”¨æ—¥å¿—æ‰“å°çš„åŠŸèƒ½&quot; class=&quot;headerlink&quot; title=&quot;ç”¨ babel å®ç°ç”¨ @!æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°†ä¸ºå‡½æ•°è‡ªåŠ¨åŠ ä¸Šè°ƒç”¨æ—¥å¿—æ‰“å°çš„åŠŸèƒ½&quot;&gt;&lt;/a&gt;ç”¨ babel å®ç°ç”¨ &lt;code&gt;@!&lt;/code&gt;æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°†ä¸ºå‡½æ•°è‡ªåŠ¨åŠ ä¸Šè°ƒç”¨æ—¥å¿—æ‰“å°çš„åŠŸèƒ½&lt;/h3&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¦‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; @! &lt;span class=&quot;title&quot;&gt;foo&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è½¬åŒ–ä¸º&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;foo&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;function name:&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;foo&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;date:&#39;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;Date&lt;/span&gt;.now())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://lilong7676.github.io/categories/javascript/"/>
    
    
      <category term="Babel" scheme="https://lilong7676.github.io/tags/Babel/"/>
    
  </entry>
  
  <entry>
    <title>babel çš„åŸç†åŠæ’ä»¶çš„ç¼–å†™ï¼ˆç®€è¦ï¼‰</title>
    <link href="https://lilong7676.github.io/2022/11/23/javascript/babel%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E6%8F%92%E4%BB%B6%E7%9A%84%E7%BC%96%E5%86%99%EF%BC%88%E7%AE%80%E8%A6%81%EF%BC%89/"/>
    <id>https://lilong7676.github.io/2022/11/23/javascript/babelçš„åŸç†åŠæ’ä»¶çš„ç¼–å†™ï¼ˆç®€è¦ï¼‰/</id>
    <published>2022-11-23T02:39:06.000Z</published>
    <updated>2023-06-08T06:26:43.565Z</updated>
    
    <content type="html"><![CDATA[<!-- # ä»€ä¹ˆæ˜¯ AST # è®¿é—®è€…æ¨¡å¼# babel-parser# babel-traverse --><h3 id="ç”±æµ…å…¥æ·±ï¼Œå…ˆä»å‡ ä¸ªç®€å•çš„æ’ä»¶çš„ç¼–å†™å¼€å§‹å§"><a href="#ç”±æµ…å…¥æ·±ï¼Œå…ˆä»å‡ ä¸ªç®€å•çš„æ’ä»¶çš„ç¼–å†™å¼€å§‹å§" class="headerlink" title="ç”±æµ…å…¥æ·±ï¼Œå…ˆä»å‡ ä¸ªç®€å•çš„æ’ä»¶çš„ç¼–å†™å¼€å§‹å§"></a>ç”±æµ…å…¥æ·±ï¼Œå…ˆä»å‡ ä¸ªç®€å•çš„æ’ä»¶çš„ç¼–å†™å¼€å§‹å§</h3><p>ï¼ˆæœ¬æ¬¡åˆ†æçš„ babel ç‰ˆæœ¬ä¸º 7.20.4ï¼‰</p><a id="more"></a><hr><blockquote><h4 id="å®ç°ä¸€ä¸ªè‡ªåŠ¨å°†-console-log-ä¿¡æ¯åŠ ä¸Šæ‰€å±ä»£ç çš„ä½ç½®ï¼ˆè¡Œåˆ—ï¼‰ä¿¡æ¯çš„-babel-æ’ä»¶"><a href="#å®ç°ä¸€ä¸ªè‡ªåŠ¨å°†-console-log-ä¿¡æ¯åŠ ä¸Šæ‰€å±ä»£ç çš„ä½ç½®ï¼ˆè¡Œåˆ—ï¼‰ä¿¡æ¯çš„-babel-æ’ä»¶" class="headerlink" title="å®ç°ä¸€ä¸ªè‡ªåŠ¨å°† console.log ä¿¡æ¯åŠ ä¸Šæ‰€å±ä»£ç çš„ä½ç½®ï¼ˆè¡Œåˆ—ï¼‰ä¿¡æ¯çš„ babel æ’ä»¶"></a><em>å®ç°ä¸€ä¸ªè‡ªåŠ¨å°† console.log ä¿¡æ¯åŠ ä¸Šæ‰€å±ä»£ç çš„ä½ç½®ï¼ˆè¡Œåˆ—ï¼‰ä¿¡æ¯çš„ babel æ’ä»¶</em></h4></blockquote><p>ä¾‹å­ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> a = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'a'</span>, a);</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆæŸ¥çœ‹è¿™æ®µä»£ç å¯¹åº”çš„<a href="https://astexplorer.net/#/gist/9357ea04e1cbba03852c2978bf5f4ecb/75b12e8e7c4e82217e17ba7ec6f9db1d7c555aae" target="_blank" rel="noopener"> AST ç»“æ„</a></li></ul><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221207111654.png" alt="AST ç»“æ„"></p><ul><li><p>åœ¨ä¸Šå›¾å¯ä»¥çœ‹åˆ° <code>console.log</code> å¯¹åº”çš„èŠ‚ç‚¹ç±»å‹ä¸º <code>CallExpression -&gt; MemberExpress -&gt; Identifier</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯æ˜¯ï¼š</p><ul><li>æ‰¾åˆ°ç±»å‹ä¸º CallExpression çš„èŠ‚ç‚¹</li><li>åˆ¤æ–­å…¶ä»£ç æ˜¯å¦æ˜¯ console.log</li><li>æ‹¿åˆ°ä½ç½®ä¿¡æ¯</li><li>æ’å…¥åˆ° arguments æ•°ç»„ä¸­</li></ul></li></ul><p>å…·ä½“å®ç°ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">"@babel/core"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> testCode = <span class="string">`function test() &#123;</span></span><br><span class="line"><span class="string">  const a = 2;</span></span><br><span class="line"><span class="string">  console.log('a', a);</span></span><br><span class="line"><span class="string">  return a;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">test();</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCustomPlugin</span>(<span class="params">&#123; types &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    visitor: &#123;</span><br><span class="line">      CallExpression(path, state) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ callee æ˜¯å¦æ˜¯ console.log</span></span><br><span class="line">        <span class="keyword">const</span> callee = generate(path.node.callee).code;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"console.log"</span> === callee) &#123;</span><br><span class="line">          <span class="comment">// æ‹¿åˆ°å…¶ä»£ç ä½ç½®ä¿¡æ¯</span></span><br><span class="line">          <span class="keyword">const</span> &#123; line, column &#125; = path.node.loc.start;</span><br><span class="line">          <span class="comment">// å°†ä½ç½®ä¿¡æ¯æ’å…¥åˆ° arguments æ•°ç»„ä¸­</span></span><br><span class="line">          path.node.arguments.unshift(</span><br><span class="line">            types.stringLiteral(<span class="string">`loc:[<span class="subst">$&#123;line&#125;</span>,<span class="subst">$&#123;column&#125;</span>]`</span>)</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> output = babel.transformSync(testCode, &#123;</span><br><span class="line">  plugins: [myCustomPlugin],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(output.code);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221207114055.png" alt></p><br><hr><blockquote><h4 id="æŠŠä»£ç é‡Œçš„-æ ‡è¯†ç¬¦n-è½¬æ¢ä¸º-æ ‡è¯†ç¬¦x"><a href="#æŠŠä»£ç é‡Œçš„-æ ‡è¯†ç¬¦n-è½¬æ¢ä¸º-æ ‡è¯†ç¬¦x" class="headerlink" title="æŠŠä»£ç é‡Œçš„ æ ‡è¯†ç¬¦n è½¬æ¢ä¸º æ ‡è¯†ç¬¦x"></a><em>æŠŠä»£ç é‡Œçš„ æ ‡è¯†ç¬¦n è½¬æ¢ä¸º æ ‡è¯†ç¬¦x</em></h4></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸‹é¢çš„é€»è¾‘æ˜¯æŠŠ ä»£ç é‡Œçš„ æ ‡è¯†ç¬¦n è½¬æ¢ä¸º æ ‡è¯†ç¬¦x</span></span><br><span class="line"><span class="keyword">const</span> &#123; parse &#125; = <span class="built_in">require</span>(<span class="string">'../babel-lib/packages/babel-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">'../babel-lib/packages/babel-traverse'</span>).default;</span><br><span class="line"><span class="keyword">const</span> generate = <span class="built_in">require</span>(<span class="string">'../babel-lib/packages/babel-generator'</span>).default;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">'const n = 1'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// parse the code -&gt; ast</span></span><br><span class="line"><span class="keyword">const</span> ast = parse(code);</span><br><span class="line"></span><br><span class="line"><span class="comment">// transform the ast</span></span><br><span class="line">traverse(ast, &#123;</span><br><span class="line">  enter(path) &#123;</span><br><span class="line">    <span class="comment">// 'n' to 'x'</span></span><br><span class="line">    <span class="keyword">if</span> (path.isIdentifier(&#123; <span class="attr">name</span>: <span class="string">'n'</span> &#125;)) &#123;</span><br><span class="line">      path.node.name = <span class="string">'x'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ast to code</span></span><br><span class="line"><span class="keyword">const</span> output = generate(ast);</span><br><span class="line"><span class="built_in">console</span>.log(output.code); <span class="comment">// 'const x = 1;'</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢å®ç°äº†ä¸€äº›ç®€å•çš„ babel è½¬æ¢æ’ä»¶ï¼Œå®ç°æ€è·¯ä¹Ÿå¾ˆæ¸…æ™°äº†ï¼Œæ•´ä½“çš„æ€è·¯å°±æ˜¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code -&gt; AST -&gt; transformed AST -&gt; transformed code</span><br></pre></td></tr></table></figure><p>ä¸‹é¢åˆ†æä¸‹å…¶åŸºæœ¬åŸç†ã€‚</p><br><h3 id="é¦–å…ˆç®€å•ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯-AST"><a href="#é¦–å…ˆç®€å•ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯-AST" class="headerlink" title="é¦–å…ˆç®€å•ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯ AST"></a>é¦–å…ˆç®€å•ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯ AST</h3><p>AST(abstract syntax tree)ï¼Œå³æŠ½è±¡è¯­æ³•æ ‘ã€‚ </p><h4 id="å…³é”®çš„æ¦‚å¿µ"><a href="#å…³é”®çš„æ¦‚å¿µ" class="headerlink" title="å…³é”®çš„æ¦‚å¿µ"></a>å…³é”®çš„æ¦‚å¿µ</h4><ol><li>Tokenizer åˆ†è¯ï¼š å°†æ•´ä¸ªä»£ç å­—ç¬¦ä¸²åˆ†å‰²æˆè¯­æ³•å•å…ƒæ•°ç»„ï¼ˆtokenï¼‰</li></ol><p>JS ä»£ç ä¸­çš„è¯­æ³•å•å…ƒä¸»è¦æŒ‡å¦‚æ ‡è¯†ç¬¦ï¼ˆif/elseã€returnã€functionï¼‰ã€è¿ç®—ç¬¦ã€æ‹¬å·ã€æ•°å­—ã€å­—ç¬¦ä¸²ã€ç©ºæ ¼ç­‰ç­‰èƒ½è¢«è§£æçš„æœ€å°å•ã€‚ <a href="https://esprima.org/demo/parse.html#" target="_blank" rel="noopener">å¯ä»¥çœ‹ä¸‹è¿™ä¸ªåœ¨çº¿åˆ†è¯å·¥å…·</a>;</p><p>2.è¯­æ³•åˆ†æï¼š åœ¨åˆ†è¯ç»“æœçš„åŸºç¡€ä¸Šåˆ†æè¯­æ³•å•å…ƒä¹‹é—´çš„å…³ç³»ã€‚</p><p>è¯­ä¹‰åˆ†æåˆ™æ˜¯å°†å¾—åˆ°çš„è¯æ±‡è¿›è¡Œä¸€ä¸ªç«‹ä½“çš„ç»„åˆï¼Œç¡®å®šè¯è¯­ä¹‹é—´çš„å…³ç³»ã€‚</p><p>å…ˆç†è§£ä¸¤ä¸ªé‡è¦æ¦‚å¿µï¼Œå³è¯­å¥å’Œè¡¨è¾¾å¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span> + <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>è¯­å¥(statement)ï¼ŒğŸ‘†ä¸Šé¢å°±æ˜¯ä¸€æ¡è¯­å¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨jsé‡Œæ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªè¯­å¥ã€‚<br>è¡¨è¾¾å¼(expression)ï¼Œå¦‚ä¸Šé¢çš„ <code>1 + 2</code>å°±æ˜¯è¡¨è¾¾å¼ï¼Œæ˜¯æŒ‡æœ€ç»ˆæœ‰è¿”å›ç»“æœçš„ä¸€å°æ®µä»£ç ï¼Œå¯ä»¥åµŒå…¥åˆ°å¦ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸”åŒ…å«åœ¨è¯­å¥ä¸­ã€‚<br>ç®€å•æ¥è¯´è¯­æ³•åˆ†ææ˜¯å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¯†åˆ«ï¼Œè¿™æ˜¯ä¸ªé€’å½’è¿‡ç¨‹ï¼Œåœ¨è§£æä¸­ï¼Œbabel ä¼šåœ¨è§£ææ¯ä¸ªè¯­å¥å’Œè¡¨è¾¾å¼çš„è¿‡ç¨‹ä¸­è®¾ç½®ä¸€ä¸ªæš‚å­˜å™¨ï¼Œç”¨æ¥æš‚å­˜å½“å‰è¯»å–åˆ°çš„è¯­æ³•å•å…ƒï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œå°±ä¼šè¿”å›ä¹‹å‰çš„æš‚å­˜ç‚¹ï¼Œå†æŒ‰ç…§å¦ä¸€ç§æ–¹å¼è¿›è¡Œè§£æï¼Œå¦‚æœè§£ææˆåŠŸï¼Œåˆ™å°†æš‚å­˜ç‚¹é”€æ¯ï¼Œä¸æ–­é‡å¤ä»¥ä¸Šæ“ä½œï¼Œç›´åˆ°æœ€åç”Ÿæˆå¯¹åº”çš„è¯­æ³•æ ‘ã€‚</p><p>å…ˆçœ‹ä¸‹ç¼–è¯‘åŸç†ä¸­ï¼Œè¯æ³•åˆ†æåˆ°è¯­æ³•åˆ†æé˜¶æ®µå›¾ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221207165755.png" alt="è¯æ³•åˆ†æåˆ°è¯­æ³•åˆ†æ"></p><p>ä¸Šé¢çš„äº§ç‰© parse tree å³è§£ææ ‘ï¼Œä»£è¡¨äº†æºç çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¾ˆè¯¦ç»†ï¼Œä¹Ÿå¾ˆå†—ä½™ï¼ˆåŒ…å«åˆ†å·ï¼Œå†’å·ç­‰ï¼‰ï¼Œè€Œ ASTï¼ŒæŠ½è±¡äº†ä¸€äº›ï¼Œå³ç²¾ç®€äº† parse treeï¼š</p><p><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221207170423.png" alt></p><ul><li>ASTä¸å«æœ‰è¯­æ³•ç»†èŠ‚ï¼Œæ¯”å¦‚å†’å·ã€æ‹¬å·ã€åˆ†å·</li><li>ASTä¼šå‹ç¼©å•ç»§æ‰¿èŠ‚ç‚¹</li><li>æ“ä½œç¬¦ä¼šå˜æˆå†…éƒ¨èŠ‚ç‚¹ï¼Œä¸å†ä¼šä»¥å¶å­èŠ‚ç‚¹å‡ºç°åœ¨æ ‘çš„æœ«ç«¯ã€‚</li></ul><h3 id="é‚£-babel-æ€ä¹ˆå°†ä»£ç è½¬ä¸º-AST-çš„ï¼Ÿ"><a href="#é‚£-babel-æ€ä¹ˆå°†ä»£ç è½¬ä¸º-AST-çš„ï¼Ÿ" class="headerlink" title="é‚£ babel æ€ä¹ˆå°†ä»£ç è½¬ä¸º AST çš„ï¼Ÿ"></a>é‚£ babel æ€ä¹ˆå°†ä»£ç è½¬ä¸º AST çš„ï¼Ÿ</h3><p>æ ¹æ®<a href="https://babeljs.io/docs/en/babel-parser#output" target="_blank" rel="noopener">æ–‡æ¡£</a>å¯çŸ¥è¦åœ¨ <code>packages/babel-parser</code> é‡Œæ‰¾é€»è¾‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ babel æºç ç›®å½•é‡Œæ‰§è¡Œ</span></span><br><span class="line">$ make watch <span class="comment"># ç¼–è¯‘å¹¶ watch</span></span><br><span class="line">$ <span class="built_in">cd</span> packages/babel-parse/<span class="built_in">test</span></span><br><span class="line"><span class="comment"># åœ¨ babel-parse é‡Œæ–°å»ºå•å…ƒæµ‹è¯•æ–‡ä»¶ï¼Œç”¨æ¥éªŒè¯é€»è¾‘</span></span><br><span class="line">$ touch <span class="built_in">test</span>-parser.js</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test-parser.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; parse &#125; <span class="keyword">from</span> <span class="string">"../lib/index.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getParser</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// sourceType å¯èƒ½çš„å€¼ä¸º "script", "module", or "unambiguous"ï¼Œ</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯ unambiguousï¼Œåˆ™ babel ä¼šå°è¯•åˆ¤æ–­ä»£ç ä¸­æ˜¯å¦åŒ…å« import export è¯­å¥æ¥ç¡®å®šå…·ä½“ç±»å‹</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> parse(code, &#123; <span class="attr">sourceType</span>: <span class="string">"module"</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">"æµ‹è¯• parse -&gt; ast"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">"should parse"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    expect(getParser(<span class="string">`function foo() &#123;&#125;`</span>)()).toMatchSnapshot();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œ jest</span></span><br><span class="line"> $ BABEL_ENV=<span class="built_in">test</span> node_modules/.bin/jest -u packages/babel-parser/<span class="built_in">test</span>/<span class="built_in">test</span>-parser.js</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ <code>parse</code> å‡½æ•°æºç ï¼Œå¾—åˆ°å…¶æ‰§è¡Œè·¯å¾„ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221208144240.png" alt="parse()æ‰§è¡Œè·¯å¾„"></p><p>å…¶ä¸­ Parser ç±»ç»§æ‰¿å…³ç³»ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221208140115.png" alt="Parser ç»§æ‰¿è·¯å¾„"></p><p>å…³æ³¨ç‚¹è½¬ç§»åˆ° <code>parser.parse()</code> å‡½æ•°ä¸­ï¼ŒæŸ¥çœ‹<a href="https://github.com/lilong7676/babel/blob/871fd5ec0c22829495d6a11b1729feb7e9e52ad7/packages/babel-parser/src/parser/index.ts#L39" target="_blank" rel="noopener">æºç :</a>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">parse(): N.File &#123;</span><br><span class="line">  <span class="comment">// è¿›å…¥åˆ°åˆå§‹ä½œç”¨åŸŸä¸­</span></span><br><span class="line">  <span class="keyword">this</span>.enterInitialScopes();</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– fileã€program èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">const</span> file = <span class="keyword">this</span>.startNode() <span class="keyword">as</span> N.File;</span><br><span class="line">  <span class="keyword">const</span> program = <span class="keyword">this</span>.startNode() <span class="keyword">as</span> N.Program;</span><br><span class="line">  <span class="comment">// è·å–å¹¶æ›´æ–°ä¸‹ä¸€ä¸ª token ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">this</span>.nextToken();</span><br><span class="line">  file.errors = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// ä»å¤´èŠ‚ç‚¹å¼€å§‹è§£æ</span></span><br><span class="line">  <span class="keyword">this</span>.parseTopLevel(file, program);</span><br><span class="line">  file.errors = <span class="keyword">this</span>.state.errors;</span><br><span class="line">  <span class="comment">// è¿”å›è§£æç»“æœï¼Œå³ ast</span></span><br><span class="line">  <span class="keyword">return</span> file;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³æ³¨ç‚¹è½¬ç§»åˆ° <code>this.nextToken()</code> æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å¹¶æ›´æ–°ä¸‹ä¸€ä¸ª token ä¿¡æ¯</span></span><br><span class="line">  nextToken(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// å¿½ç•¥ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€tabã€æ¢è¡Œç­‰ï¼‰å¹¶æ›´æ–°å½“å‰ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">this</span>.skipSpace();</span><br><span class="line">    <span class="comment">// è®°å½•å½“å‰ token å¼€å§‹å­—ç¬¦ä½ç½®</span></span><br><span class="line">    <span class="keyword">this</span>.state.start = <span class="keyword">this</span>.state.pos;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯ â€œä¸´æ—¶å‘å‰çœ‹â€ï¼Œåˆ™è®°å½• token å¼€å§‹ä½ç½®ï¼ˆè¡Œã€åˆ—ã€indexï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isLookahead) <span class="keyword">this</span>.state.startLoc = <span class="keyword">this</span>.state.curPosition();</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰ tokenizer çš„ä½ç½®å·²ç»åˆ°äº† input çš„æœ«å°¾</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.pos &gt;= <span class="keyword">this</span>.length) &#123;</span><br><span class="line">      <span class="comment">// åˆ™ç»“æŸæœ¬æ¬¡ token æŸ¥æ‰¾ï¼Œå¹¶æ›´æ–°å½“å‰ token çš„ä¿¡æ¯ï¼ˆä½ç½®ã€tokenç±»å‹ã€tokenå€¼ï¼‰åˆ° state ä¸Š</span></span><br><span class="line">      <span class="keyword">this</span>.finishToken(tt.eof);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ¹æ®å½“å‰çš„ å­—ç¬¦ï¼Œè¯»å–ç›¸åº”çš„ token</span></span><br><span class="line">    <span class="keyword">this</span>.getTokenFromCode(<span class="keyword">this</span>.codePointAtPos(<span class="keyword">this</span>.state.pos));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ„Ÿå…´è¶£çš„å¯ä»¥ç»§ç»­æŸ¥çœ‹ <code>getTokenFromCode</code> çš„å®ç°é€»è¾‘ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯ tokenzier çš„æ ¸å¿ƒé€»è¾‘</p></blockquote><p>å…³æ³¨ç‚¹è½¬ç§»åˆ°  <code>parseTopLevel() -&gt; parseProgram -&gt; parseBlockBody -&gt; parseBlockOrModuleBlockBody -&gt;  parseStatement -&gt; parseStatementContent</code><br>å…·ä½“é€»è¾‘å¯ä»¥æŸ¥çœ‹ <a href="https://github.com/lilong7676/babel/tree/main/packages/babel-parser/src" target="_blank" rel="noopener">github</a> ä¸Šæ·»åŠ çš„ä»£ç æ³¨é‡Šã€‚</p><hr><h3 id="babel-æ˜¯å¦‚ä½•éå†-astçš„ï¼Ÿ"><a href="#babel-æ˜¯å¦‚ä½•éå†-astçš„ï¼Ÿ" class="headerlink" title="babel æ˜¯å¦‚ä½•éå† astçš„ï¼Ÿ"></a>babel æ˜¯å¦‚ä½•éå† astçš„ï¼Ÿ</h3><p>åœ¨ <code>packages/babel-traverse</code> æœ‰ä¸¤ä¸ªå…³é”®çš„å¯¹è±¡:</p><p><strong>Visitor</strong><br>å¯¹äºè¿™ä¸ªéå†è¿‡ç¨‹ï¼Œbabel é€šè¿‡å®ä¾‹åŒ– visitor å¯¹è±¡å®Œæˆï¼Œå…¶å®æˆ‘ä»¬ç”Ÿæˆå‡ºæ¥çš„ AST ç»“æ„éƒ½æ‹¥æœ‰ä¸€ä¸ª accept æ–¹æ³•ç”¨æ¥æ¥æ”¶ visitor è®¿é—®è€…å¯¹è±¡çš„è®¿é—®ï¼Œè€Œè®¿é—®è€…å…¶ä¸­ä¹Ÿå®šä¹‰äº† visit æ–¹æ³•(å³å¼€å‘è€…å®šä¹‰çš„å‡½æ•°æ–¹æ³•)ä½¿å…¶èƒ½å¤Ÿå¯¹æ ‘çŠ¶ç»“æ„ä¸åŒèŠ‚ç‚¹åšå‡ºä¸åŒçš„å¤„ç†ï¼Œå€Ÿæ­¤åšåˆ°åœ¨å¯¹è±¡ç»“æ„çš„ä¸€æ¬¡è®¿é—®è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå†æ•´ä¸ªå¯¹è±¡ç»“æ„ã€‚ï¼ˆè®¿é—®è€…è®¾è®¡æ¨¡å¼ï¼šæä¾›ä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œè¡¨ç¤ºï¼Œå®ƒä½¿å¾—å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ çš„ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œï¼‰</p><p>éå†ç»“ç‚¹è®©æˆ‘ä»¬å¯ä»¥å®šä½å¹¶æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦æ“ä½œçš„ç»“ç‚¹ï¼Œåœ¨éå†æ¯ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå­˜åœ¨enterå’Œexitä¸¤ä¸ªæ—¶æ€å‘¨æœŸï¼Œä¸€ä¸ªæ˜¯è¿›å…¥ç»“ç‚¹æ—¶ï¼Œè¿™ä¸ªæ—¶å€™èŠ‚ç‚¹çš„å­èŠ‚ç‚¹è¿˜æ²¡è§¦è¾¾ï¼Œéå†å­èŠ‚ç‚¹å®Œæˆçš„åï¼Œä¼šç¦»å¼€è¯¥èŠ‚ç‚¹å¹¶è§¦å‘exitæ–¹æ³•ã€‚</p><p><strong>Path</strong><br>Visitors åœ¨éå†åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œéƒ½ä¼šç»™æˆ‘ä»¬ä¼ å…¥ path å‚æ•°ï¼ŒåŒ…å«äº†èŠ‚ç‚¹çš„ä¿¡æ¯ä»¥åŠèŠ‚ç‚¹å’Œæ‰€åœ¨çš„ä½ç½®ï¼Œä¾›æˆ‘ä»¬å¯¹ç‰¹å®šèŠ‚ç‚¹è¿›è¡Œä¿®æ”¹ï¼Œä¹‹æ‰€ä»¥ç§°ä¹‹ä¸º path æ˜¯å…¶è¡¨ç¤ºçš„æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿æ¥çš„å¯¹è±¡ï¼Œè€ŒéæŒ‡å½“å‰çš„èŠ‚ç‚¹å¯¹è±¡ã€‚pathå±æ€§æœ‰å‡ ä¸ªé‡è¦çš„ç»„æˆï¼Œä¸»è¦å¦‚ä¸‹ï¼š<br><img src="https://lilong7676-picture.oss-cn-hangzhou.aliyuncs.com/img/20221209142949.png" alt="Path"></p><p>å…³é”®è·¯å¾„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// babel-traverse</span><br><span class="line">traverse(options) -&gt; traverseNode(...) -&gt; new TraversalContext() -&gt; context.visit(node, key)</span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><p><a href="https://medium.com/basecs/leveling-up-ones-parsing-game-with-asts-d7a6fc2400ff" target="_blank" rel="noopener">Leveling Up Oneâ€™s Parsing Game With ASTs</a></p><h4 id="å½©è›‹ï¼šBabel-song"><a href="#å½©è›‹ï¼šBabel-song" class="headerlink" title="å½©è›‹ï¼šBabel song"></a>å½©è›‹ï¼šBabel song</h4><p>Hallelujah â€”â€”  <a href="https://youtu.be/40abpedBKK8" target="_blank" rel="noopener">In Praise of Babel</a></p>]]></content>
    
    <summary type="html">
    
      &lt;!-- # ä»€ä¹ˆæ˜¯ AST 
# è®¿é—®è€…æ¨¡å¼
# babel-parser
# babel-traverse --&gt;

&lt;h3 id=&quot;ç”±æµ…å…¥æ·±ï¼Œå…ˆä»å‡ ä¸ªç®€å•çš„æ’ä»¶çš„ç¼–å†™å¼€å§‹å§&quot;&gt;&lt;a href=&quot;#ç”±æµ…å…¥æ·±ï¼Œå…ˆä»å‡ ä¸ªç®€å•çš„æ’ä»¶çš„ç¼–å†™å¼€å§‹å§&quot; class=&quot;headerlink&quot; title=&quot;ç”±æµ…å…¥æ·±ï¼Œå…ˆä»å‡ ä¸ªç®€å•çš„æ’ä»¶çš„ç¼–å†™å¼€å§‹å§&quot;&gt;&lt;/a&gt;ç”±æµ…å…¥æ·±ï¼Œå…ˆä»å‡ ä¸ªç®€å•çš„æ’ä»¶çš„ç¼–å†™å¼€å§‹å§&lt;/h3&gt;&lt;p&gt;ï¼ˆæœ¬æ¬¡åˆ†æçš„ babel ç‰ˆæœ¬ä¸º 7.20.4ï¼‰&lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://lilong7676.github.io/categories/javascript/"/>
    
    
      <category term="Babel" scheme="https://lilong7676.github.io/tags/Babel/"/>
    
  </entry>
  
  <entry>
    <title>åˆæ­¥å®‰è£… knative</title>
    <link href="https://lilong7676.github.io/2022/09/08/Knative/%E5%88%9D%E6%AD%A5%E5%AE%89%E8%A3%85-Knative/"/>
    <id>https://lilong7676.github.io/2022/09/08/Knative/åˆæ­¥å®‰è£…-Knative/</id>
    <published>2022-09-08T02:02:11.000Z</published>
    <updated>2023-06-08T06:26:43.566Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://knative.dev/docs/getting-started/quickstart-install/#before-you-begin" target="_blank" rel="noopener">https://knative.dev/docs/getting-started/quickstart-install/#before-you-begin</a></p><p>æ³¨æ„ï¼Œç”±äºæˆ‘åœ¨è™šæ‹Ÿæœºé‡Œèµ°äº†vpnä»£ç†ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤éƒ½æ²¡æœ‰ä½¿ç”¨å›½å†…æºã€‚</p><p>å‰ææ¡ä»¶ï¼š</p><ol><li>å®‰è£…äº† minikubeã€kubectlï¼Œå‚è€ƒ <a href="https://lilong7676.github.io/2022/09/08/minikube/k8s/%E5%9C%A8-vmware-centos7-%E4%B8%AD%E6%8E%A2%E7%B4%A2-k8s-%E4%B8%8E-KNative/">åœ¨ vmware centos7 ä¸­å®‰è£… minikube</a>.</li></ol><a id="more"></a><h1 id="1-å®‰è£…-Knative-CLI-ï¼ˆknï¼‰-å‚è€ƒè¿æ¥"><a href="#1-å®‰è£…-Knative-CLI-ï¼ˆknï¼‰-å‚è€ƒè¿æ¥" class="headerlink" title="1. å®‰è£… Knative CLI ï¼ˆknï¼‰(å‚è€ƒè¿æ¥)"></a>1. å®‰è£… Knative CLI ï¼ˆknï¼‰(<a href="https://knative.dev/docs/getting-started/quickstart-install/#install-the-knative-cli" target="_blank" rel="noopener">å‚è€ƒè¿æ¥</a>)</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½äºŒè¿›åˆ¶åŒ…</span></span><br><span class="line">$ curl -fsSL https://github.com/knative/client/releases/download/knative-v1.7.0/kn-linux-amd64 -O</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å‘½åäºŒè¿›åˆ¶åŒ…åä¸º kn</span></span><br><span class="line">$ mv kn-linux-amd64 kn</span><br><span class="line">$ chmod +x kn</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»åŠ¨ kn åˆ° bin ç›®å½•</span></span><br><span class="line">$ sudo mv kn /usr/<span class="built_in">local</span>/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line">$ kn version</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220914105352.png" alt="kn version"></p><h1 id="2-å®‰è£…-Knative-quickstart-æ’ä»¶-å‚è€ƒé“¾æ¥"><a href="#2-å®‰è£…-Knative-quickstart-æ’ä»¶-å‚è€ƒé“¾æ¥" class="headerlink" title="2. å®‰è£… Knative quickstart æ’ä»¶ (å‚è€ƒé“¾æ¥)"></a>2. å®‰è£… Knative quickstart æ’ä»¶ (<a href="https://knative.dev/docs/getting-started/quickstart-install/#install-the-knative-quickstart-plugin" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a>)</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ kn-quickstart-linux-amd64 äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line">$ curl -fsSL https://github.com/knative-sandbox/kn-plugin-quickstart/releases/download/knative-v1.7.1/kn-quickstart-linux-amd64 -O</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å‘½åä¸º kn-quickstart</span></span><br><span class="line">$ mv kn-quickstart-linux-amd64 kn-quickstart</span><br><span class="line">$ chmod +x kn-quickstart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»åŠ¨ kn-quickstart åˆ° bin ç›®å½•</span></span><br><span class="line">$ sudo mv kn-quickstart /usr/<span class="built_in">local</span>/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">$ kn quickstart --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220914110252.png" alt="kn quickstart --help"></p><h1 id="3-è¿è¡Œ-Knative-quickstart-æ’ä»¶-ï¼ˆå‚è€ƒï¼‰"><a href="#3-è¿è¡Œ-Knative-quickstart-æ’ä»¶-ï¼ˆå‚è€ƒï¼‰" class="headerlink" title="3.è¿è¡Œ Knative quickstart æ’ä»¶ ï¼ˆå‚è€ƒï¼‰"></a>3.è¿è¡Œ Knative quickstart æ’ä»¶ ï¼ˆ<a href="https://knative.dev/docs/getting-started/quickstart-install/#run-the-knative-quickstart-plugin" target="_blank" rel="noopener">å‚è€ƒ</a>ï¼‰</h1><p><code>quickstart</code> æ’ä»¶ä¼šå®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š  </p><ol><li>æ£€æŸ¥ä½ æ˜¯å¦å·²ç»å®‰è£…äº†æ‰€é€‰çš„ k8s å®ä¾‹</li><li>åˆ›å»ºä¸€ä¸ªé›†ç¾¤ï¼Œåå­—ä¸º <code>knative</code></li><li>å®‰è£… Knative Servingï¼Œä½¿ç”¨ <code>Kourier</code> ä½œä¸ºé»˜è®¤çš„ç½‘ç»œå±‚ï¼Œ<code>sslip.io</code>ä½œä¸º DNS</li><li>å®‰è£… Knative Eventingï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ª in-memory Broker å’Œ Channel çš„å®ç°</li></ol><p>ä¸ºäº†åœ¨æœ¬åœ°éƒ¨ç½² Knativeï¼Œéœ€è¦è¿è¡Œ <code>quickstart</code> æ’ä»¶:<br>ç”±äºæœ¬åœ°å·²ç»å®‰è£…äº† <code>minikube</code>ï¼Œæ‰€ä»¥è¿™é‡Œä»¥ <code>minikube</code> å¯åŠ¨æ’ä»¶ï¼š  </p><ol><li>åœ¨ <code>minikube</code> å®ä¾‹ä¸­å®‰è£… Knative å’Œ k8s:<blockquote><p>æ³¨æ„ï¼šminikube é›†ç¾¤å°†ä½¿ç”¨ 6GB å†…å­˜åˆ›å»ºã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œåˆ™å¯ä»¥åœ¨è¯¥å‘½ä»¤ä¹‹å‰è¿è¡Œå‘½ä»¤ <code>minikube config set memory 3078</code>ï¼Œå°†å…¶æ›´æ”¹ä¸ºä¸ä½äº <code>3 GB</code> çš„å…¶ä»–å€¼ã€‚</p></blockquote></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kn quickstart minikube</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220914145319.png" alt="kn quickstart minikube"></p><ol start="2"><li>æ ¹æ®ä¸Šä¸€æ­¥ä¸­çš„æç¤ºï¼Œæ–°å¼€ä¸€ä¸ª terminal çª—å£ï¼Œæ‰§è¡Œ:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ minikube tunnel --profile knative</span><br></pre></td></tr></table></figure></li></ol><p>åœ¨ä½¿ç”¨ Knative <code>quickstart</code> ç¯å¢ƒæ—¶ï¼Œç»ˆç«¯é‡Œå¿…é¡»è¿è¡Œæ­¤ <code>tunnel</code></p><ol start="3"><li><p>å›åˆ°ä¸Šä¸€ä¸ªçª—å£ï¼ŒæŒ‰ <code>Enter</code> é”®ç»§ç»­å®‰è£…</p></li><li><p>éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minikube profile list</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220914145849.png" alt="minikube profile list"></p><h1 id="4-éƒ¨ç½²ä¸€ä¸ª-Knative-Service-å‚è€ƒ"><a href="#4-éƒ¨ç½²ä¸€ä¸ª-Knative-Service-å‚è€ƒ" class="headerlink" title="4. éƒ¨ç½²ä¸€ä¸ª Knative Service (å‚è€ƒ)"></a>4. éƒ¨ç½²ä¸€ä¸ª Knative Service (<a href="https://knative.dev/docs/getting-started/first-service/#deploying-a-knative-service" target="_blank" rel="noopener">å‚è€ƒ</a>)</h1><p>æœ‰ä¸¤ç§æ–¹å¼éƒ¨ç½²ï¼Œå¯é€‰ <code>kn</code> å‘½ä»¤éƒ¨ç½² æˆ–è€…ç¼–å†™ YAML é…ç½®æ–‡ä»¶å¹¶ä½¿ç”¨ <code>kubectl apply</code> éƒ¨ç½²ï¼Œå…·ä½“å¯å‚è€ƒå®˜ç½‘ã€‚</p><ol><li>ä½¿ç”¨ <code>kn</code> éƒ¨ç½²<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kn service create hello \</span><br><span class="line">--image gcr.io/knative-samples/helloworld-go \</span><br><span class="line">--port 8080 \</span><br><span class="line">--env TARGET=World</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;br&gt;&lt;a href=&quot;https://knative.dev/docs/getting-started/quickstart-install/#before-you-begin&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://knative.dev/docs/getting-started/quickstart-install/#before-you-begin&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œç”±äºæˆ‘åœ¨è™šæ‹Ÿæœºé‡Œèµ°äº†vpnä»£ç†ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤éƒ½æ²¡æœ‰ä½¿ç”¨å›½å†…æºã€‚&lt;/p&gt;
&lt;p&gt;å‰ææ¡ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£…äº† minikubeã€kubectlï¼Œå‚è€ƒ &lt;a href=&quot;https://lilong7676.github.io/2022/09/08/minikube/k8s/%E5%9C%A8-vmware-centos7-%E4%B8%AD%E6%8E%A2%E7%B4%A2-k8s-%E4%B8%8E-KNative/&quot;&gt;åœ¨ vmware centos7 ä¸­å®‰è£… minikube&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Knative" scheme="https://lilong7676.github.io/categories/Knative/"/>
    
    
  </entry>
  
  <entry>
    <title>åœ¨ vmware centos7 ä¸­å®‰è£…ä¸æ¢ç´¢ k8s</title>
    <link href="https://lilong7676.github.io/2022/09/08/minikube/k8s/%E5%9C%A8-vmware-centos7-%E4%B8%AD%E5%AE%89%E8%A3%85%E4%B8%8E%E6%8E%A2%E7%B4%A2-k8s/"/>
    <id>https://lilong7676.github.io/2022/09/08/minikube/k8s/åœ¨-vmware-centos7-ä¸­å®‰è£…ä¸æ¢ç´¢-k8s/</id>
    <published>2022-09-08T02:02:11.000Z</published>
    <updated>2023-06-08T06:26:43.566Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener">https://minikube.sigs.k8s.io/docs/start/</a><br><a href="https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script" target="_blank" rel="noopener">https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script</a><br><a href="https://www.cnblogs.com/yyee/p/15071684.html" target="_blank" rel="noopener">https://www.cnblogs.com/yyee/p/15071684.html</a></p><p>æ³¨æ„ï¼Œç”±äºæˆ‘åœ¨è™šæ‹Ÿæœºé‡Œèµ°äº†vpnä»£ç†ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤éƒ½æ²¡æœ‰ä½¿ç”¨å›½å†…æºã€‚</p><a id="more"></a><h3 id="ä½¿ç”¨-SSH-è¿æ¥-VMware-ä¸Šçš„-CentOS-è™šæ‹Ÿæœºï¼ˆå¯é€‰ï¼‰"><a href="#ä½¿ç”¨-SSH-è¿æ¥-VMware-ä¸Šçš„-CentOS-è™šæ‹Ÿæœºï¼ˆå¯é€‰ï¼‰" class="headerlink" title="ä½¿ç”¨ SSH è¿æ¥ VMware ä¸Šçš„ CentOS è™šæ‹Ÿæœºï¼ˆå¯é€‰ï¼‰"></a>ä½¿ç”¨ SSH è¿æ¥ VMware ä¸Šçš„ CentOS è™šæ‹Ÿæœºï¼ˆå¯é€‰ï¼‰</h3><ul><li><p>å®‰è£… openssh-server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install openssh-server</span><br></pre></td></tr></table></figure></li><li><p>å¯ç”¨22ç«¯å£ç›‘å¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># å–æ¶ˆä¸‹é¢ä¸¤è¡Œçš„æ³¨é‡Š</span></span><br><span class="line"><span class="comment"># Port 22</span></span><br><span class="line"><span class="comment"># ListenAddress 0.0.0.0</span></span><br></pre></td></tr></table></figure></li><li><p>å¼€å¯ sshd æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service sshd start</span><br></pre></td></tr></table></figure></li><li><p>æ£€æµ‹ 22 ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -an | grep 22</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220908143016.png" alt="æ£€æµ‹ 22 ç«¯å£"></p></li><li><p>ä¸»æœºä¸è™šæ‹Ÿæœºè¿›è¡Œäº’ç›¸pingï¼Œå¦‚æœpingé€šäº†ï¼Œè¡¨ç¤ºä¸»æœºå’Œè™šæ‹Ÿæœºåœ¨åŒä¸€ä¸ªå­ç½‘ï¼Œåˆ™ç›´æ¥ <code>ssh root@ip</code> å³å¯ã€‚</p></li><li><p>å¦‚æœæ²¡æœ‰pingé€šï¼Œåˆ™è¡¨ç¤ºä¸»æœºå’Œè™šæ‹Ÿæœºæ²¡æœ‰åœ¨ä¸€ä¸ªå­—ç½‘ï¼Œéœ€è¦ä¿®æ”¹ç½‘ç»œé…ç½®ï¼Œå¯å‚è€ƒ<a href="https://www.jianshu.com/p/f38133c1485a" target="_blank" rel="noopener">è¿™é‡Œ</a>è¿›è¡Œé…ç½®ã€‚</p></li></ul><h3 id="å®‰è£…-docker-å’Œ-minikube"><a href="#å®‰è£…-docker-å’Œ-minikube" class="headerlink" title="å®‰è£… docker å’Œ minikube"></a>å®‰è£… docker å’Œ minikube</h3><ul><li><p>å®‰è£… docker engine</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script</span></span><br><span class="line">$ curl -fsSL https://get.docker.com -o get-docker.sh</span><br><span class="line">$ sudo sh get-docker.sh</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start docker</span><br></pre></td></tr></table></figure></li><li><p>Add your user to the â€˜dockerâ€™ group</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo usermod -aG docker <span class="variable">$USER</span> &amp;&amp; newgrp docker</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… minikube</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å›½å†…æœ€å¥½èµ°ä»£ç†è®¿é—®ï¼Œå‚è€ƒè‡ª https://minikube.sigs.k8s.io/docs/handbook/vpn_and_proxy/#macos-and-linux</span></span><br><span class="line"><span class="comment"># export HTTP_PROXY="http://yourip:port" </span></span><br><span class="line"><span class="comment"># export HTTPS_PROXY="http://yourip:port"</span></span><br><span class="line"><span class="comment"># export NO_PROXY=localhost,127.0.0.1,10.96.0.0/12,192.168.59.0/24,192.168.49.0/24,192.168.39.0/24</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://minikube.sigs.k8s.io/docs/start/</span></span><br><span class="line">$ curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span><br><span class="line">$ sudo install minikube-linux-amd64 /usr/<span class="built_in">local</span>/bin/minikube</span><br></pre></td></tr></table></figure></li><li><p><a href="https://minikube.sigs.k8s.io/docs/drivers/docker/#requirements" target="_blank" rel="noopener">é…ç½® minikube(å¯é€‰)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Start a cluster using the docker driver:</span></span><br><span class="line">minikube start --driver=docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># To make docker the default driver:</span></span><br><span class="line">minikube config <span class="built_in">set</span> driver docker</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¯åŠ¨-minikube"><a href="#å¯åŠ¨-minikube" class="headerlink" title="å¯åŠ¨ minikube"></a>å¯åŠ¨ minikube</h3>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœå·²ç»èµ°ä»£ç†äº†ï¼Œåˆ™ç›´æ¥æ‰§è¡Œ</span></span><br><span class="line">$ minikube start </span><br><span class="line"><span class="comment"># å¦åˆ™å›½å†…ç¯å¢ƒæœ€å¥½ä½¿ç”¨é•œåƒæº</span></span><br><span class="line">$ minikube start --image-mirror-country cn \</span><br><span class="line">--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers</span><br><span class="line"><span class="comment"># å¦‚æœå‡ºç°ä¸‹é¢æç¤ºï¼Œè§£å†³æ–¹æ¡ˆå‚è€ƒï¼š https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user</span></span><br><span class="line"><span class="comment">#âŒ  Exiting due to DRV_AS_ROOT: The "docker" driver should not be used with root privileges.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œ `minikube start`åï¼Œä¼šä¸‹è½½å®‰è£… k8sç­‰ä¾èµ–ï¼Œè€å¿ƒç­‰å¾…</span></span><br></pre></td></tr></table></figure><p>  æ­¤æ—¶æ‰§è¡Œ <code>$ docker ps</code>ä¼šå‘ç° minikube å…¶å®å°±æ˜¯dockerä¸­è¿è¡Œçš„å®¹å™¨ã€‚<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  $ docker ps</span><br><span class="line">  CONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                                                                                                                                  NAMES</span><br><span class="line">c07efbc6d848   kicbase/stable:v0.0.33   <span class="string">"/usr/local/bin/entrâ€¦"</span>   14 minutes ago   Up 14 minutes   127.0.0.1:49162-&gt;22/tcp, 127.0.0.1:49161-&gt;2376/tcp, 127.0.0.1:49160-&gt;5000/tcp, 127.0.0.1:49159-&gt;8443/tcp, 127.0.0.1:49158-&gt;32443/tcp   minikube</span><br></pre></td></tr></table></figure></p><h3 id="å®‰è£…-kubectl"><a href="#å®‰è£…-kubectl" class="headerlink" title="å®‰è£… kubectl"></a>å®‰è£… kubectl</h3><ul><li>å¯å‚è€ƒè¿™é‡Œï¼š <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl -LO <span class="string">"https://dl.k8s.io/release/<span class="variable">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl"</span></span><br><span class="line"></span><br><span class="line">$ sudo install -o root -g root -m 0755 kubectl /usr/<span class="built_in">local</span>/bin/kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">$ kubectl version --client</span><br></pre></td></tr></table></figure><h1 id="åˆæ­¥ä½¿ç”¨"><a href="#åˆæ­¥ä½¿ç”¨" class="headerlink" title="åˆæ­¥ä½¿ç”¨"></a>åˆæ­¥ä½¿ç”¨</h1><ul><li><p>ä½¿ç”¨ <code>kubectl</code> æŸ¥çœ‹å½“å‰é›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get po -A</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220909113846.png" alt="ä½¿ç”¨ kubectl æŸ¥çœ‹å½“å‰é›†ç¾¤"></p></li><li><p>minikube é›†æˆäº† k8s Dashboard,å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å½“å‰é›†ç¾¤æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ minikube dashboard</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220909114717.png" alt="minikube dashboard"></p><p>æš´éœ²ç«¯å£ç»™å¤–éƒ¨è®¿é—®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl proxy --address=<span class="string">'0.0.0.0'</span> --<span class="built_in">disable</span>-filter=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220909120236.png" alt="æš´éœ²ç«¯å£ç»™å¤–éƒ¨è®¿é—®"></p><p>å‘ç°æš´éœ²äº†8001ç«¯å£ç»™å¤–éƒ¨è®¿é—®ï¼Œä½†æ˜¯æ­¤æ—¶åœ¨å®¿ä¸»æœºæ— æ³•æ‰“å¼€ <code>http://centos_ip:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</code> ,å› ä¸ºé˜²ç«å¢™çš„é…ç½®ä¸å…è®¸ï¼Œæ‰€ä»¥ğŸ‘‡ä¸‹é¢æ˜¯é…ç½®é˜²ç«å¢™çš„æ­¥éª¤ã€‚</p></li><li><p>é…ç½® centos é˜²ç«å¢™ä»¥æš´éœ²æŒ‡å®šç«¯å£ç»™å®¿ä¸»æœºè®¿é—®ï¼ˆ<a href="https://www.cnblogs.com/yyee/p/15071684.html" target="_blank" rel="noopener">å‚è€ƒè‡ªè¿™é‡Œ</a>ï¼‰</p><p>å› ä¸ºæˆ‘æ˜¯æœ¬åœ°ç”¨çš„è™šæ‹Ÿæœºå®‰è£…çš„ centos7ï¼Œæ‰€ä»¥ä¸Šé¢çš„ dashboard é¡µé¢æ— æ³•ç›´æ¥åœ¨å®¿ä¸»æœºå†…æ‰“å¼€ï¼Œæ‰€ä»¥å‚è€ƒè¿™é‡Œä¿®æ”¹centos é˜²ç«å¢™å³å¯</p><p>é¦–å…ˆå‰ææ˜¯æˆ‘çš„è™šæ‹Ÿæœºç½‘ç»œèµ°çš„æ˜¯ NATè½¬å‘æ¨¡å¼ï¼Œä»¥ä¸‹ä¸ºåœ¨è™šæ‹Ÿæœºå†…æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®é˜²ç«å¢™å…è®¸NATè½¬å‘</span></span><br><span class="line">$ sudo firewall-cmd --zone=public --add-masquerade --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ ifconfig å‘½ä»¤æŸ¥çœ‹ 127.0.0.1 å±äºå“ªä¸ªç½‘å¡ï¼Œæˆ‘è¿™é‡Œç½‘å¡çš„åå­—æ˜¯ lo</span></span><br><span class="line"><span class="comment"># ä¸‹é¢æŠŠ lo ç½‘å¡æ·»åŠ åˆ° trusted åŸŸ</span></span><br><span class="line">$ sudo firewall-cmd --permanent --zone=trusted --change-interface=lo</span><br><span class="line"></span><br><span class="line"><span class="comment"># PS: æˆ‘è¿™é‡Œé¡ºä¾¿æŠŠ docker0 ç½‘å¡ä¹Ÿæ·»åŠ åˆ°ä¿¡ä»»åŸŸäº†ï¼Œæ–¹ä¾¿ä»¥åè®¿é—®dockerå†…çš„ç«¯å£</span></span><br><span class="line"><span class="comment"># sudo firewall-cmd --permanent --zone=trusted --change-interface=docker0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€æ”¾ 8001 ç«¯å£ï¼ˆminikube dashboard proxy é»˜è®¤ä¸º 8001 ç«¯å£ï¼‰</span></span><br><span class="line">$ sudo firewall-cmd --add-port=8001/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯é˜²ç«å¢™å³å¯</span></span><br><span class="line">$ firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åœ¨å®¿ä¸»æœºå³å¯è®¿é—®è™šæ‹Ÿæœº8001ç«¯å£ï¼š <code>http://vm_ip:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/#/workloads?namespace=default</code></p></li></ul><h1 id="éƒ¨ç½²ä¸€ä¸ªåº”ç”¨è¯•è¯•"><a href="#éƒ¨ç½²ä¸€ä¸ªåº”ç”¨è¯•è¯•" class="headerlink" title="éƒ¨ç½²ä¸€ä¸ªåº”ç”¨è¯•è¯•"></a>éƒ¨ç½²ä¸€ä¸ªåº”ç”¨è¯•è¯•</h1><p>è¿™é‡Œå¯ä»¥å‚è€ƒå®˜ç½‘çš„æ•™ç¨‹ï¼ˆ<a href="https://minikube.sigs.k8s.io/docs/start/ï¼‰ï¼Œå®˜ç½‘éƒ¨ç½²çš„æ˜¯:`k8s.gcr.io/echoserver:1.4`,ä½†æ˜¯ä¸€ç›´æ˜¾ç¤ºpull" target="_blank" rel="noopener">https://minikube.sigs.k8s.io/docs/start/ï¼‰ï¼Œå®˜ç½‘éƒ¨ç½²çš„æ˜¯:`k8s.gcr.io/echoserver:1.4`,ä½†æ˜¯ä¸€ç›´æ˜¾ç¤ºpull</a> image å¤±è´¥ï¼Œåº”è¯¥æ˜¯é•œåƒåœ°å€è®¿é—®é—®é¢˜ï¼Œæ‰€ä»¥è¿™äº†æ¢æˆäº†å¦ä¸€ä¸ªdemoé•œåƒï¼Œä½ å¯ä»¥æ¢æˆä»»ä½•dockeré•œåƒã€‚</p><ul><li><p>æ ¹æ® demo é•œåƒåˆ›å»ºä¸€ä¸ª deployment</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment wordpress --image=wordpress</span><br></pre></td></tr></table></figure></li><li><p>æš´éœ² NodePort ç«¯å£åˆ° 80ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„ç«¯å£å¿…é¡»ä¸dockeré•œåƒæš´éœ²çš„ç«¯å£ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•è®¿é—®åˆ°é•œåƒå†…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl expose deployment wordpress --<span class="built_in">type</span>=NodePort --port=80</span><br></pre></td></tr></table></figure></li><li><p>æ˜¾ç¤ºè®¿é—®åœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœä¸åŠ  --urlï¼Œåˆ™ä¼šè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</span></span><br><span class="line">$ minikube services wordpress --url</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220909160506.png" alt="æ˜¾ç¤ºè®¿é—®åœ°å€"></p></li><li><p>ä¸€äº›å¸¸ç”¨å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤º services åˆ—è¡¨</span></span><br><span class="line">$ kubectl get services <span class="comment">#å¯ç®€å†™ä¸º kubectl get svc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå½“å‰ deployment åˆ—è¡¨</span></span><br><span class="line">$ kubectl get deployment</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ä¸€ä¸ª deployment</span></span><br><span class="line">$ kubectl delete deployment <span class="variable">$deploymentname</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ä¸€ä¸ª service</span></span><br><span class="line">$ kubectl delete <span class="variable">$servicename</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h1><ol><li>minikube services wordpress åœ¨æµè§ˆå™¨ä¸­æ‰“ä¸å¼€è¿™ä¸ªåœ°å€<br>è§£å†³æ–¹å¼ï¼šç»“æœå‘ç°æ˜¯ terminal ä½¿ç”¨äº†ä»£ç†ï¼Œé‡æ–°æ‰“å¼€ä¸€ä¸ª terminal å†æ‰§è¡Œå‘½ä»¤å°±å¯ä»¥äº†ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;br&gt;&lt;a href=&quot;https://minikube.sigs.k8s.io/docs/start/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://minikube.sigs.k8s.io/docs/start/&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://www.cnblogs.com/yyee/p/15071684.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/yyee/p/15071684.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œç”±äºæˆ‘åœ¨è™šæ‹Ÿæœºé‡Œèµ°äº†vpnä»£ç†ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤éƒ½æ²¡æœ‰ä½¿ç”¨å›½å†…æºã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="minikube" scheme="https://lilong7676.github.io/categories/minikube/"/>
    
      <category term="k8s" scheme="https://lilong7676.github.io/categories/minikube/k8s/"/>
    
    
  </entry>
  
  <entry>
    <title>flutterä¸­é€šè¿‡ffiä½¿ç”¨quickjs</title>
    <link href="https://lilong7676.github.io/2022/09/01/flutter/flutter%E4%B8%AD%E9%80%9A%E8%BF%87ffi%E4%BD%BF%E7%94%A8quickjs/"/>
    <id>https://lilong7676.github.io/2022/09/01/flutter/flutterä¸­é€šè¿‡ffiä½¿ç”¨quickjs/</id>
    <published>2022-09-01T02:43:43.000Z</published>
    <updated>2023-06-08T06:26:43.565Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>quickjsä¸­ åˆ¤æ–­ JSValue çš„ç±»å‹</p><p>  åœ¨ <code>quickjs.h</code> ä¸­ æœç´¢ <code>JS_Is</code>å¼€å¤´çš„æ–¹æ³•:</p><ul><li>JS_IsBool(JSValue)</li><li>JS_IsNull</li><li>JS_IsUndefined</li><li>JS_IsNumber</li><li>JS_IsString</li><li>JS_IsObject</li><li>JS_IsException</li><li>â€¦</li><li><a id="more"></a></li></ul></li><li><p>quickjsä¸­çš„ JSValue ä¸ c ç±»å‹çš„è½¬æ¢</p><p>   åœ¨<code>quickjs.h</code>ä¸­æœç´¢ <code>JS_To</code>å¼€å¤´çš„æ–¹æ³•ï¼š</p><ul><li>JS_ToBool(JSContext, JSValue)</li><li>JS_ToInt32</li><li>JS_ToInt64</li><li>JS_ToFloat64</li><li>JS_ToCString    éœ€æ³¨æ„ JS_FreeCString</li></ul></li></ul><p>ä¸ºä»€ä¹ˆ <code>webf</code> ä¸­çš„ <code>NativeString</code> ç±»å‹ï¼Œä½¿ç”¨ uint16_t* è¡¨ç¤º string?</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NativeString</span> &#123;</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint16_t</span>* <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">uint32_t</span> length;</span><br><span class="line"></span><br><span class="line">  <span class="function">NativeString* <span class="title">clone</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> é¦–å…ˆï¼Œ uint16_t å³ä¸º unsigned short int ç±»å‹ï¼Œå€¼èŒƒå›´ä¸º 0 - 65535ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> **/</span></span><br></pre></td></tr></table></figure><ul><li>æœ‰å…³ JSStringã€JSAtom çš„åˆ†æï¼š<ul><li><a href="https://blog.csdn.net/jayyuz/article/details/124450556" target="_blank" rel="noopener">https://blog.csdn.net/jayyuz/article/details/124450556</a></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;p&gt;quickjsä¸­ åˆ¤æ–­ JSValue çš„ç±»å‹&lt;/p&gt;
&lt;p&gt;  åœ¨ &lt;code&gt;quickjs.h&lt;/code&gt; ä¸­ æœç´¢ &lt;code&gt;JS_Is&lt;/code&gt;å¼€å¤´çš„æ–¹æ³•:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JS_IsBool(JSValue)&lt;/li&gt;
&lt;li&gt;JS_IsNull&lt;/li&gt;
&lt;li&gt;JS_IsUndefined&lt;/li&gt;
&lt;li&gt;JS_IsNumber&lt;/li&gt;
&lt;li&gt;JS_IsString&lt;/li&gt;
&lt;li&gt;JS_IsObject&lt;/li&gt;
&lt;li&gt;JS_IsException&lt;/li&gt;
&lt;li&gt;â€¦&lt;/li&gt;
&lt;li&gt;
    
    </summary>
    
      <category term="flutter" scheme="https://lilong7676.github.io/categories/flutter/"/>
    
    
  </entry>
  
  <entry>
    <title>webå‰ç«¯Proxyæ²™ç®±å®ç°æ—¶éœ€æ³¨æ„RegExpç­‰åŸç”Ÿå¯¹è±¡é—®é¢˜</title>
    <link href="https://lilong7676.github.io/2022/08/31/javascript/web%E5%89%8D%E7%AB%AFProxy%E6%B2%99%E7%AE%B1%E5%AE%9E%E7%8E%B0%E6%97%B6%E9%9C%80%E6%B3%A8%E6%84%8FRegExp%E7%AD%89%E5%8E%9F%E7%94%9F%E5%AF%B9%E8%B1%A1%E9%97%AE%E9%A2%98/"/>
    <id>https://lilong7676.github.io/2022/08/31/javascript/webå‰ç«¯Proxyæ²™ç®±å®ç°æ—¶éœ€æ³¨æ„RegExpç­‰åŸç”Ÿå¯¹è±¡é—®é¢˜/</id>
    <published>2022-08-31T06:52:01.000Z</published>
    <updated>2023-06-08T06:26:43.565Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜èµ·å› "><a href="#é—®é¢˜èµ·å› " class="headerlink" title="é—®é¢˜èµ·å› "></a>é—®é¢˜èµ·å› </h2><p>èµ·å› æ˜¯ä¸€ä¸ªå‰ç«¯jsæ²™ç®±çš„å®ç°ä¸­ï¼Œå‘ç°é€šè¿‡æ²™ç®±æ‰§è¡Œä»£ç ä¸­è®¿é—® RegExp.$n çš„å€¼ä¸€ç›´æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">    const r = /^(\\d&#123;4&#125;)-(\\d&#123;1,2&#125;)-(\\d&#123;1,2&#125;)$/</span></span><br><span class="line"><span class="string">    r.exec('2022-08-31')</span></span><br><span class="line"><span class="string">    return RegExp.$1;`</span>;</span><br><span class="line">evalScriptInSandbox(code);</span><br></pre></td></tr></table></figure><a id="more"></a><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>evalScriptInSandbox(code)</code> åº”è¯¥è¿”å› <code>&#39;2022&#39;</code>,ä½†æ˜¯æ‰§è¡Œå‘ç°åªä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œæœ€åå‘ç°æ˜¯ RegExp çš„æ‰§è¡Œä¸Šä¸‹æ–‡é—®é¢˜ã€‚</p><p>å› ä¸ºæ²™ç®±çš„å®ç°ç±»ä¼¼äºè¿™ç§ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> evalScriptSandbox = <span class="function">(<span class="params">code, fakeWindow</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> resolver = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">`</span></span><br><span class="line"><span class="string">    return function(window) &#123;</span></span><br><span class="line"><span class="string">      with(window) &#123;</span></span><br><span class="line"><span class="string">        try &#123;</span></span><br><span class="line"><span class="string">          return (function() &#123;</span></span><br><span class="line"><span class="string">            "use strict";</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;code&#125;</span></span></span><br><span class="line"><span class="string">          &#125;)();</span></span><br><span class="line"><span class="string">        &#125; catch(e) &#123;</span></span><br><span class="line"><span class="string">          console.log(e);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ­£æ˜¯è¿™é‡Œçš„ call(fakeWindow)å¯¼è‡´ RegExp æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡æ˜¯ fakeWindow </span></span><br><span class="line">  <span class="comment">// è€Œä¸æ˜¯çœŸæ­£çš„å®¿ä¸» window,å¯¼è‡´ bug äº§ç”Ÿ</span></span><br><span class="line">  <span class="keyword">return</span> resolver().call(fakeWindow, fakeWindow);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹å¼å°±æ˜¯è®¿é—®<code>fakeWindow</code>ä¸­çš„ <code>RegExp</code> å¯¹è±¡æ—¶ï¼Œéœ€è¦è¿”å›å®¿ä¸»ç¯å¢ƒçš„ <code>RegExp</code>ï¼Œè¿™å’Œæµè§ˆå™¨çš„å†…éƒ¨å®ç°æœ‰å…³ç³»ï¼Œæš‚æ—¶æ²¡å‘ç°å…¶ä»–çš„è§£å†³æ–¹å¼ã€‚</p><h2 id="Reproduce-Step"><a href="#Reproduce-Step" class="headerlink" title="Reproduce Step :"></a>Reproduce Step :</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/lilong7676/js-regexp-bug.git</span><br><span class="line">$ <span class="built_in">cd</span> js-regexp-bug</span><br><span class="line">$ npm i</span><br><span class="line">$ npm run start</span><br></pre></td></tr></table></figure><h2 id="âš ï¸"><a href="#âš ï¸" class="headerlink" title="âš ï¸"></a>âš ï¸</h2><p>âš ï¸å¦å¤–éœ€è¦æ³¨æ„ï¼Œåœ¨ evalã€Function æ„é€ å‡½æ•°ä¸­æ‰§è¡Œæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œéœ€è¦è½¬ä¹‰åæ–œçº¿ï¼Œå³:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">`</span></span><br><span class="line"><span class="string">const r = /^(\d&#123;4&#125;)-(\d&#123;1,2&#125;)-(\d&#123;1,2&#125;)$/</span></span><br><span class="line"><span class="string">r.exec('2022-08-31'); // null</span></span><br><span class="line"><span class="string">console.log(RegExp.$1) // ''</span></span><br><span class="line"><span class="string">`</span>)</span><br></pre></td></tr></table></figure><p>åœ¨ eval ä¸­éœ€è¦å†™ä¸º:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">`</span></span><br><span class="line"><span class="string">const r = /^(\\d&#123;4&#125;)-(\\d&#123;1,2&#125;)-(\\d&#123;1,2&#125;)$/</span></span><br><span class="line"><span class="string">r.exec('2022-08-31');</span></span><br><span class="line"><span class="string">console.log(RegExp.$1); // 2022</span></span><br><span class="line"><span class="string">`</span>)</span><br></pre></td></tr></table></figure><h3 id="ç±»ä¼¼çš„åŸç”Ÿå¯¹è±¡ï¼Œå¦‚-eval-ç­‰ï¼Œä¹Ÿä¼šåœ¨è¿™ç§æ²™ç®±çš„å®ç°æ–¹å¼ä¸­å‡ºç°ä½œç”¨åŸŸé—®é¢˜ï¼Œéœ€è¦æ³¨æ„ã€‚"><a href="#ç±»ä¼¼çš„åŸç”Ÿå¯¹è±¡ï¼Œå¦‚-eval-ç­‰ï¼Œä¹Ÿä¼šåœ¨è¿™ç§æ²™ç®±çš„å®ç°æ–¹å¼ä¸­å‡ºç°ä½œç”¨åŸŸé—®é¢˜ï¼Œéœ€è¦æ³¨æ„ã€‚" class="headerlink" title="ç±»ä¼¼çš„åŸç”Ÿå¯¹è±¡ï¼Œå¦‚ eval ç­‰ï¼Œä¹Ÿä¼šåœ¨è¿™ç§æ²™ç®±çš„å®ç°æ–¹å¼ä¸­å‡ºç°ä½œç”¨åŸŸé—®é¢˜ï¼Œéœ€è¦æ³¨æ„ã€‚"></a>ç±»ä¼¼çš„åŸç”Ÿå¯¹è±¡ï¼Œå¦‚ eval ç­‰ï¼Œä¹Ÿä¼šåœ¨è¿™ç§æ²™ç®±çš„å®ç°æ–¹å¼ä¸­å‡ºç°ä½œç”¨åŸŸé—®é¢˜ï¼Œéœ€è¦æ³¨æ„ã€‚</h3>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é—®é¢˜èµ·å› &quot;&gt;&lt;a href=&quot;#é—®é¢˜èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜èµ·å› &quot;&gt;&lt;/a&gt;é—®é¢˜èµ·å› &lt;/h2&gt;&lt;p&gt;èµ·å› æ˜¯ä¸€ä¸ªå‰ç«¯jsæ²™ç®±çš„å®ç°ä¸­ï¼Œå‘ç°é€šè¿‡æ²™ç®±æ‰§è¡Œä»£ç ä¸­è®¿é—® RegExp.$n çš„å€¼ä¸€ç›´æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; code = &lt;span class=&quot;string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    const r = /^(\\d&amp;#123;4&amp;#125;)-(\\d&amp;#123;1,2&amp;#125;)-(\\d&amp;#123;1,2&amp;#125;)$/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    r.exec(&#39;2022-08-31&#39;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    return RegExp.$1;`&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;evalScriptInSandbox(code);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://lilong7676.github.io/categories/javascript/"/>
    
    
  </entry>
  
  <entry>
    <title>è®° RegExp å­—é¢é‡å½¢å¼åœ¨ eval åŠ new Functioné‡Œçš„è¡Œä¸ºå¼‚å¸¸é—®é¢˜</title>
    <link href="https://lilong7676.github.io/2022/08/29/uncategorized/%E8%AE%B0RegExp-%E5%9C%A8Eval%E5%8F%8Anew-Function%E9%87%8C%E7%9A%84%E8%A1%8C%E4%B8%BA%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/"/>
    <id>https://lilong7676.github.io/2022/08/29/uncategorized/è®°RegExp-åœ¨EvalåŠnew-Functioné‡Œçš„è¡Œä¸ºå¼‚å¸¸é—®é¢˜/</id>
    <published>2022-08-29T01:31:43.000Z</published>
    <updated>2023-06-08T06:26:43.567Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆçœ‹ä¸€ä¸‹æœ€ç®€å•çš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> r = <span class="regexp">/^(\d&#123;4&#125;)-(\d&#123;1,2&#125;)-(\d&#123;1,2&#125;)$/</span>;</span><br><span class="line">r.exec(<span class="string">'2019-10-08'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$<span class="number">1</span>); <span class="comment">// 2019</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç åœ¨ Chrome console ä¸­æ‰§è¡Œç»“æœä¸º 2019ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">`</span></span><br><span class="line"><span class="string">const r = /^(\d&#123;4&#125;)-(\d&#123;1,2&#125;)-(\d&#123;1,2&#125;)$/;</span></span><br><span class="line"><span class="string">r.exec('2019-10-08');</span></span><br><span class="line"><span class="string">RegExp.$1;</span></span><br><span class="line"><span class="string">`</span>); <span class="comment">// ''</span></span><br></pre></td></tr></table></figure><p><code>é‡æ–°æ‰“å¼€ä¸€ä¸ª Chrome console</code>, ç„¶åæ‰§è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œç»“æœä¸º<code>ç©ºå­—ç¬¦ä¸²</code>ï¼Œç»è¿‡æŸ¥é˜…èµ„æ–™ï¼Œå‘ç°åœ¨ eval ä¸­æ‰§è¡Œ regxçš„å­—é¢é‡æ—¶ï¼Œéœ€è¦<code>é¢å¤–è½¬ä¹‰</code>åæ–œçº¿ï¼Œå³ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">`</span></span><br><span class="line"><span class="string">const r = /^(\\d&#123;4&#125;)-(\\d&#123;1,2&#125;)-(\\d&#123;1,2&#125;)$/;</span></span><br><span class="line"><span class="string">r.exec('2019-10-08');</span></span><br><span class="line"><span class="string">RegExp.$1;</span></span><br><span class="line"><span class="string">`</span>); <span class="comment">// '2019'</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><a href="https://stackoverflow.com/a/61147060/11394539" target="_blank" rel="noopener">https://stackoverflow.com/a/61147060/11394539</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é¦–å…ˆçœ‹ä¸€ä¸‹æœ€ç®€å•çš„ä»£ç &lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; r = &lt;span class=&quot;regexp&quot;&gt;/^(\d&amp;#123;4&amp;#125;)-(\d&amp;#123;1,2&amp;#125;)-(\d&amp;#123;1,2&amp;#125;)$/&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;r.exec(&lt;span class=&quot;string&quot;&gt;&#39;2019-10-08&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;built_in&quot;&gt;RegExp&lt;/span&gt;.$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// 2019&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;ä¸Šé¢è¿™æ®µä»£ç åœ¨ Chrome console ä¸­æ‰§è¡Œç»“æœä¸º 2019ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;eval&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;const r = /^(\d&amp;#123;4&amp;#125;)-(\d&amp;#123;1,2&amp;#125;)-(\d&amp;#123;1,2&amp;#125;)$/;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;r.exec(&#39;2019-10-08&#39;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;RegExp.$1;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;`&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// &#39;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;é‡æ–°æ‰“å¼€ä¸€ä¸ª Chrome console&lt;/code&gt;, ç„¶åæ‰§è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œç»“æœä¸º&lt;code&gt;ç©ºå­—ç¬¦ä¸²&lt;/code&gt;ï¼Œ
ç»è¿‡æŸ¥é˜…èµ„æ–™ï¼Œå‘ç°åœ¨ eval ä¸­æ‰§è¡Œ regxçš„å­—é¢é‡æ—¶ï¼Œéœ€è¦&lt;code&gt;é¢å¤–è½¬ä¹‰&lt;/code&gt;åæ–œçº¿ï¼Œå³ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;eval&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;const r = /^(\\d&amp;#123;4&amp;#125;)-(\\d&amp;#123;1,2&amp;#125;)-(\\d&amp;#123;1,2&amp;#125;)$/;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;r.exec(&#39;2019-10-08&#39;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;RegExp.$1;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;`&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// &#39;2019&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªç®€å•çš„ WebAssembly ç¼–è¯‘æµç¨‹ demo</title>
    <link href="https://lilong7676.github.io/2022/08/25/WebAssembly/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84WebAssembly%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8Bdemo/"/>
    <id>https://lilong7676.github.io/2022/08/25/WebAssembly/ä¸€ä¸ªç®€å•çš„WebAssemblyç¼–è¯‘æµç¨‹demo/</id>
    <published>2022-08-25T08:09:19.000Z</published>
    <updated>2023-06-08T06:26:43.566Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸‹å¦‚ä½•è®²ä¸€ä¸ªç®€å•çš„ç¨‹åºç¼–è¯‘ä¸º wasmã€‚ç”±äºæˆ‘æ˜¯macç¯å¢ƒï¼Œæ‰€ä»¥ä»¥ä¸‹ä»¥macç¯å¢ƒä¸ºä¸»ï¼Œå…¶ä»–ç¯å¢ƒè¯·å‚è€ƒ <a href="https://github.com/emscripten-core/emsdk" target="_blank" rel="noopener">å®˜æ–¹github</a>ã€‚</p><a id="more"></a><h2 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶:"></a>å‰ç½®æ¡ä»¶:</h2><p>gitã€cmakeã€Xcode(ä¸»è¦æ˜¯llvm, linuxä¸ºGCC)ã€Python 2.7.x</p><h2 id="ç¼–è¯‘-emsdk"><a href="#ç¼–è¯‘-emsdk" class="headerlink" title="ç¼–è¯‘ emsdk:"></a>ç¼–è¯‘ emsdk:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/juj/emsdk.git</span><br><span class="line">$ <span class="built_in">cd</span> emsdk</span><br><span class="line">$ ./emsdk install latest</span><br><span class="line">$ ./emsdk activate latest</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›å°† emsdk åŠ å…¥åˆ°ç»ˆç«¯çš„ç¯å¢ƒå˜é‡é‡Œï¼Œåˆ™æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> <span class="string">"&#123;path_to_emsdk&#125;/emsdk_env.sh"</span></span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘ä¸€ä¸ªdemoè¯•è¯•å§ï¼š"><a href="#ç¼–è¯‘ä¸€ä¸ªdemoè¯•è¯•å§ï¼š" class="headerlink" title="ç¼–è¯‘ä¸€ä¸ªdemoè¯•è¯•å§ï¼š"></a>ç¼–è¯‘ä¸€ä¸ªdemoè¯•è¯•å§ï¼š</h2><ol><li><p>æ–°å»ºä¸€ä¸ª hello.cï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"hello world\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ emcc hello.c -s WASM=1 -o hello.html</span><br></pre></td></tr></table></figure></li></ol><p>æ³¨æ„ *-s WASM=1 * å‚æ•°ï¼Œä¸åŠ è¿™ä¸ªè¯ï¼Œä¼šç¼–è¯‘ä¸ºasm.jsã€‚</p><p>å¦‚æœæƒ³è¦ç”Ÿæˆä¸€ä¸ªæ¨¡æ¿ html é¡µé¢ï¼Œåˆ™è¾“å‡ºæ–‡ä»¶çš„æ ¼å¼éœ€ä¸º htmlï¼Œå³ * -o hello.html *ã€‚</p><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220825180332.png" alt="ç”Ÿæˆçš„æ–‡ä»¶"></p><ol start="3"><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ emrun å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ª http åè®®çš„ web server æ¥å±•ç¤ºæˆ‘ä»¬ç¼–è¯‘åçš„æ–‡ä»¶ã€‚</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ emrun --no_browser --port 8080 .</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨æµè§ˆå™¨æ‰“å¼€ <a href="http://0.0.0.0:8080/hello.htmlï¼š" target="_blank" rel="noopener">http://0.0.0.0:8080/hello.htmlï¼š</a><br><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220825180019.png" alt="æ•ˆæœå›¾"></li></ol><h2 id="å°è¯•åŠ å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“è¿›è¡Œç¼–è¯‘"><a href="#å°è¯•åŠ å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“è¿›è¡Œç¼–è¯‘" class="headerlink" title="å°è¯•åŠ å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“è¿›è¡Œç¼–è¯‘"></a>å°è¯•åŠ å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“è¿›è¡Œç¼–è¯‘</h2><p>è¿™é‡Œæˆ‘é€‰æ‹©å°† <a href="https://github.com/DaveGamble/cJSON" target="_blank" rel="noopener">cJSON</a> è¿™ä¸ªåº“ç¼–è¯‘ä¸º wasm:</p><ol><li><p>ä» github ä¸‹è½½ cJSOM æºç åˆ°é¡¹ç›®çš„ vendor æ–‡ä»¶å¤¹</p></li><li><p>æ–°å»º main.cï¼Œå†…å®¹ä¸º:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"cJSON/cJSON.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> jsonstr[] = <span class="string">"&#123;\"data\":\"Hello World!!!\"&#125;"</span>;</span><br><span class="line">    cJSON *json = cJSON_Parse(jsonstr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cJSON *data = cJSON_GetObjectItem(json, <span class="string">"data"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, cJSON_GetStringValue(data));</span><br><span class="line"></span><br><span class="line">    cJSON_Delete(json);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»º CMakeLists.txt:</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>) <span class="comment"># æ ¹æ®ä½ çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹</span></span><br><span class="line"><span class="keyword">project</span>(sample C)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_STANDARD <span class="number">11</span>) <span class="comment"># æ ¹æ®ä½ çš„Cç¼–è¯‘å™¨æ”¯æŒæƒ…å†µè¿›è¡Œä¿®æ”¹</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_EXECUTABLE_SUFFIX <span class="string">".html"</span>) <span class="comment"># ç¼–è¯‘ç”Ÿæˆ.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(vendor) <span class="comment"># ä½¿å¾—æˆ‘ä»¬èƒ½å¼•ç”¨ç¬¬ä¸‰æ–¹åº“çš„å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(vendor/cJSON)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(sample main.c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®Emscriptençš„ç¼–è¯‘é“¾æ¥å‚æ•°ï¼Œæˆ‘ä»¬ç­‰ç­‰ä¼šè®²åˆ°ä¸€äº›å¸¸ç”¨å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set_target_properties</span>(sample PROPERTIES LINK_FLAGS <span class="string">"-s EXIT_RUNTIME=1"</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(sample cjson) <span class="comment"># å°†ç¬¬ä¸‰æ–¹åº“ä¸ä¸»ç¨‹åºè¿›è¡Œé“¾æ¥</span></span><br></pre></td></tr></table></figure></li><li><p>æ–°å»º build æ–‡ä»¶å¤¹ï¼Œå¹¶æ‰§è¡Œç¼–è¯‘æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir build</span><br><span class="line">$ <span class="built_in">cd</span> build</span><br><span class="line">$ emcmake cmake ..</span><br><span class="line">$ emmake make</span><br></pre></td></tr></table></figure></li><li><p>æ­¤æ—¶ä¼šå‘ç°æ§åˆ¶å°æŠ¥ç±»ä¼¼äºä¸‹é¢çš„é”™è¯¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[  6%] Linking C executable sample.html</span><br><span class="line">wasm-ld: error: vendor/cJSON/libcjson.a(cJSON.c.o): undefined symbol: __stack_chk_guard</span><br></pre></td></tr></table></figure></li><li><p>è§£å†³ä¸Šè¿°é”™è¯¯çš„åŠæ³•æ˜¯ä¿®æ”¹ cJSON çš„ CMakeLists.txt ä¸­çš„ -fstack-protector-strong ä¿®æ”¹ä¸º -fno-stack-protectorï¼Œç„¶åé‡å¤æ­¥éª¤4</p></li><li><p>æ­¤æ—¶ build æ–‡ä»¶å¤¹å†…å·²ç”Ÿæˆ wasmï¼š<br><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/20220826140809.png" alt="ç”Ÿæˆçš„wasm"></p></li><li><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åï¼Œåœ¨æµè§ˆå™¨ localhost:8080/sample.html æŸ¥çœ‹å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emrun --no_browser --port 8080 .</span><br></pre></td></tr></table></figure></li></ol><h2 id="åç»­å†å°è¯•å°†-flutter-jsdom-çš„-bridge-å±‚æ‰“åŒ…ä¸º-wasmï¼Œéœ€è¦å…ˆå¥½å¥½æ¶ˆåŒ–ä¸‹ğŸ˜‚"><a href="#åç»­å†å°è¯•å°†-flutter-jsdom-çš„-bridge-å±‚æ‰“åŒ…ä¸º-wasmï¼Œéœ€è¦å…ˆå¥½å¥½æ¶ˆåŒ–ä¸‹ğŸ˜‚" class="headerlink" title="åç»­å†å°è¯•å°† flutter-jsdom çš„ bridge å±‚æ‰“åŒ…ä¸º wasmï¼Œéœ€è¦å…ˆå¥½å¥½æ¶ˆåŒ–ä¸‹ğŸ˜‚"></a>åç»­å†å°è¯•å°† <a href="https://github.com/lilong7676/flutter-jsdom" target="_blank" rel="noopener">flutter-jsdom</a> çš„ bridge å±‚æ‰“åŒ…ä¸º wasmï¼Œéœ€è¦å…ˆå¥½å¥½æ¶ˆåŒ–ä¸‹ğŸ˜‚</h2><h4 id="å‚è€ƒèµ„æ–™ï¼š"><a href="#å‚è€ƒèµ„æ–™ï¼š" class="headerlink" title="å‚è€ƒèµ„æ–™ï¼š"></a>å‚è€ƒèµ„æ–™ï¼š</h4><ol><li><p><a href="https://cloud.tencent.com/developer/news/690454" target="_blank" rel="noopener">https://cloud.tencent.com/developer/news/690454</a></p></li><li><p><a href="http://webassembly.org.cn/getting-started/developers-guide/" target="_blank" rel="noopener">http://webassembly.org.cn/getting-started/developers-guide/</a></p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å½•ä¸‹å¦‚ä½•è®²ä¸€ä¸ªç®€å•çš„ç¨‹åºç¼–è¯‘ä¸º wasmã€‚ç”±äºæˆ‘æ˜¯macç¯å¢ƒï¼Œæ‰€ä»¥ä»¥ä¸‹ä»¥macç¯å¢ƒä¸ºä¸»ï¼Œå…¶ä»–ç¯å¢ƒè¯·å‚è€ƒ &lt;a href=&quot;https://github.com/emscripten-core/emsdk&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å®˜æ–¹github&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="WebAssembly" scheme="https://lilong7676.github.io/categories/WebAssembly/"/>
    
    
      <category term="WebAssembly" scheme="https://lilong7676.github.io/tags/WebAssembly/"/>
    
  </entry>
  
  <entry>
    <title>å‚è€ƒiOSå¼€å‘ä¸­çš„ UINavigationController çš„æ€æƒ³ï¼Œå®ç°ä¸€ä¸ª React NavigationController</title>
    <link href="https://lilong7676.github.io/2022/08/25/uncategorized/%E5%8F%82%E8%80%83iOS%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84-UINavigationController-%E7%9A%84%E6%80%9D%E6%83%B3%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA-React-NavigationController/"/>
    <id>https://lilong7676.github.io/2022/08/25/uncategorized/å‚è€ƒiOSå¼€å‘ä¸­çš„-UINavigationController-çš„æ€æƒ³ï¼Œå®ç°ä¸€ä¸ª-React-NavigationController/</id>
    <published>2022-08-25T07:33:09.000Z</published>
    <updated>2023-06-08T06:26:43.566Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å‚è€ƒiOSå¼€å‘ä¸­çš„-UINavigationController-çš„æ€æƒ³ï¼Œå®ç°äº†åœ¨Reacté¡¹ç›®ä¸­çš„ç±»ä¼¼-iOS-é¡µé¢è½¬åœºçš„æ•ˆæœã€‚"><a href="#å‚è€ƒiOSå¼€å‘ä¸­çš„-UINavigationController-çš„æ€æƒ³ï¼Œå®ç°äº†åœ¨Reacté¡¹ç›®ä¸­çš„ç±»ä¼¼-iOS-é¡µé¢è½¬åœºçš„æ•ˆæœã€‚" class="headerlink" title="å‚è€ƒiOSå¼€å‘ä¸­çš„ UINavigationController çš„æ€æƒ³ï¼Œå®ç°äº†åœ¨Reacté¡¹ç›®ä¸­çš„ç±»ä¼¼ iOS é¡µé¢è½¬åœºçš„æ•ˆæœã€‚"></a>å‚è€ƒiOSå¼€å‘ä¸­çš„ UINavigationController çš„æ€æƒ³ï¼Œå®ç°äº†åœ¨Reacté¡¹ç›®ä¸­çš„ç±»ä¼¼ iOS é¡µé¢è½¬åœºçš„æ•ˆæœã€‚</h4><p>githubï¼š<a href="https://github.com/lilong7676/simple-chat/tree/main/packages/navigation-controller" target="_blank" rel="noopener">navigation-controller</a></p><ul><li>ä½¿ç”¨æ–¹å¼<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install @lilong767676/navigation-controller</span><br></pre></td></tr></table></figure></li></ul><a id="more"></a>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NavigationController &#125; <span class="keyword">from</span> <span class="string">'@lilong767676/navigation-controller'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆåˆ›å»ºè·¯ç”±</span></span><br><span class="line"><span class="comment">// è·¯ç”±å - é¡µé¢ é…ç½®</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routes = &#123;</span><br><span class="line">  root: App,</span><br><span class="line">  [RouteNames.addFriendPage]: AddFriendsPage,</span><br><span class="line">  [RouteNames.newFriendsPage]: NewFriendsPage,</span><br><span class="line">  [RouteNames.chatHome]: ChatHome,</span><br><span class="line">  [RouteNames.chatPage]: ChatPage,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ– NavigationController,å•ä¾‹æ¨¡å¼ï¼Œä¿è¯å…¨å±€å”¯ä¸€</span></span><br><span class="line"><span class="keyword">const</span> naviController = <span class="keyword">new</span> NavigationController(routes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½® rootContainer</span></span><br><span class="line">naviController.setRootContainer(ele);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢è·³è½¬</span></span><br><span class="line">NavigationController.push(RouteNames.addFriendPage, props);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ä¸Šä¸€é¡µé¢</span></span><br><span class="line">NavigationController.pop();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”€æ¯ NavigationController</span></span><br><span class="line">naviController.destroy();</span><br></pre></td></tr></table></figure><h4 id="æ•ˆæœï¼š"><a href="#æ•ˆæœï¼š" class="headerlink" title="æ•ˆæœï¼š"></a>æ•ˆæœï¼š</h4><p><img src="https://raw.githubusercontent.com/lilong7676/Picture/master/blog/image/2022-08-17%2014.56.19.gif" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;å‚è€ƒiOSå¼€å‘ä¸­çš„-UINavigationController-çš„æ€æƒ³ï¼Œå®ç°äº†åœ¨Reacté¡¹ç›®ä¸­çš„ç±»ä¼¼-iOS-é¡µé¢è½¬åœºçš„æ•ˆæœã€‚&quot;&gt;&lt;a href=&quot;#å‚è€ƒiOSå¼€å‘ä¸­çš„-UINavigationController-çš„æ€æƒ³ï¼Œå®ç°äº†åœ¨Reacté¡¹ç›®ä¸­çš„ç±»ä¼¼-iOS-é¡µé¢è½¬åœºçš„æ•ˆæœã€‚&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒiOSå¼€å‘ä¸­çš„ UINavigationController çš„æ€æƒ³ï¼Œå®ç°äº†åœ¨Reacté¡¹ç›®ä¸­çš„ç±»ä¼¼ iOS é¡µé¢è½¬åœºçš„æ•ˆæœã€‚&quot;&gt;&lt;/a&gt;å‚è€ƒiOSå¼€å‘ä¸­çš„ UINavigationController çš„æ€æƒ³ï¼Œå®ç°äº†åœ¨Reacté¡¹ç›®ä¸­çš„ç±»ä¼¼ iOS é¡µé¢è½¬åœºçš„æ•ˆæœã€‚&lt;/h4&gt;&lt;p&gt;githubï¼š&lt;a href=&quot;https://github.com/lilong7676/simple-chat/tree/main/packages/navigation-controller&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;navigation-controller&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨æ–¹å¼&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ npm install @lilong767676/navigation-controller&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªç®€å•çš„web IMç¨‹åº</title>
    <link href="https://lilong7676.github.io/2022/08/25/web/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84web-IM%E7%A8%8B%E5%BA%8F/"/>
    <id>https://lilong7676.github.io/2022/08/25/web/ä¸€ä¸ªç®€å•çš„web-IMç¨‹åº/</id>
    <published>2022-08-25T07:24:03.000Z</published>
    <updated>2023-06-08T06:26:43.566Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸»è¦æŠ€æœ¯æ ˆ"><a href="#ä¸»è¦æŠ€æœ¯æ ˆ" class="headerlink" title="ä¸»è¦æŠ€æœ¯æ ˆ"></a>ä¸»è¦æŠ€æœ¯æ ˆ</h3><ul><li>React</li><li>Indexeddb(Dexie)</li><li>Socket.io</li><li>Nodejs + Express + typeorm + Mysql + Redis</li><li>Pnpm monorepo</li><li>Docker compose + Github Actions CI</li></ul><p>å®ç°ç»†èŠ‚è¯·æŸ¥çœ‹githubä»“åº“: <a href="https://github.com/lilong7676/simple-chat" target="_blank" rel="noopener">simple-chat</a></p><a id="more"></a><h3 id="ç›®å‰ä¸»è¦åŠŸèƒ½"><a href="#ç›®å‰ä¸»è¦åŠŸèƒ½" class="headerlink" title="ç›®å‰ä¸»è¦åŠŸèƒ½:"></a>ç›®å‰ä¸»è¦åŠŸèƒ½:</h3><ul><li>user register &amp; login</li><li>single chat</li></ul><h3 id="start-dev"><a href="#start-dev" class="headerlink" title="start dev:"></a>start dev:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pnpm install &amp;&amp; npm run dev-server &amp;&amp; npm run dev-static</span><br></pre></td></tr></table></figure><p>then open <em>localhost:3000/app</em> in browser.</p><h3 id="build-for-production"><a href="#build-for-production" class="headerlink" title="build for production:"></a>build for production:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker compose up</span><br></pre></td></tr></table></figure><p>then open <em>localhost/app</em> in browser.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸»è¦æŠ€æœ¯æ ˆ&quot;&gt;&lt;a href=&quot;#ä¸»è¦æŠ€æœ¯æ ˆ&quot; class=&quot;headerlink&quot; title=&quot;ä¸»è¦æŠ€æœ¯æ ˆ&quot;&gt;&lt;/a&gt;ä¸»è¦æŠ€æœ¯æ ˆ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;React&lt;/li&gt;
&lt;li&gt;Indexeddb(Dexie)&lt;/li&gt;
&lt;li&gt;Socket.io&lt;/li&gt;
&lt;li&gt;Nodejs + Express + typeorm + Mysql + Redis&lt;/li&gt;
&lt;li&gt;Pnpm monorepo&lt;/li&gt;
&lt;li&gt;Docker compose + Github Actions CI&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ç°ç»†èŠ‚è¯·æŸ¥çœ‹githubä»“åº“: &lt;a href=&quot;https://github.com/lilong7676/simple-chat&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;simple-chat&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="web" scheme="https://lilong7676.github.io/categories/web/"/>
    
    
      <category term="React" scheme="https://lilong7676.github.io/tags/React/"/>
    
      <category term="Docker" scheme="https://lilong7676.github.io/tags/Docker/"/>
    
      <category term="CI/CD" scheme="https://lilong7676.github.io/tags/CI-CD/"/>
    
      <category term="Indexeddb" scheme="https://lilong7676.github.io/tags/Indexeddb/"/>
    
      <category term="nodejs" scheme="https://lilong7676.github.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å®ç°ä¸€ä¸ªjsæµè§ˆå™¨ç«¯æ²™ç®±</title>
    <link href="https://lilong7676.github.io/2022/01/21/javascript/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAjs%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AB%AF%E6%B2%99%E7%AE%B1/"/>
    <id>https://lilong7676.github.io/2022/01/21/javascript/å¦‚ä½•å®ç°ä¸€ä¸ªjsæµè§ˆå™¨ç«¯æ²™ç®±/</id>
    <published>2022-01-21T01:39:16.000Z</published>
    <updated>2023-06-08T06:26:43.567Z</updated>
    
    <content type="html"><![CDATA[<ul><li>ä»€ä¹ˆæ˜¯æ²™ç®±?åŸºæœ¬åŸç†æ˜¯ä»€ä¹ˆ?  </li></ul><p>æ²™ç®±çš„ç›®çš„å…¶å®å°±æ˜¯éš”ç¦»å˜é‡,ä»£ç†æŸäº›å˜é‡,é˜²æ­¢æ±¡æŸ“å®¿ä¸»ç¯å¢ƒ. </p><a id="more"></a><p>åœ¨æµè§ˆå™¨ä¸­,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ js é—­åŒ…çš„èƒ½åŠ›,åˆ©ç”¨å˜é‡ä½œç”¨åŸŸå»æ¨¡æ‹Ÿä¸€ä¸ªæ²™ç®±ç¯å¢ƒ,æœ€ç®€å•çš„ä¾‹å­:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.document);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(&#123;<span class="attr">document</span>: <span class="string">'fakedocument'</span>&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç çš„è¾“å‡ºè‚¯å®šæ˜¯ fakedocument, è€Œä¸æ˜¯æµè§ˆå™¨åŸç”Ÿçš„document.  </p><ul><li>å®ç°éš¾ç‚¹:å¦‚ä½•æ¨¡æ‹Ÿæµè§ˆå™¨åŸç”Ÿwindow?</li></ul><p>æœ‰ä¸¤ä¸ªæ–¹æ¡ˆ,ä¸€æ˜¯æ ¹æ® ECMA è§„èŒƒå®ç°è¿™ä¸€å †çš„æµè§ˆå™¨åŸç”Ÿå¯¹è±¡,æ˜¾ç„¶è¿™ä¸ªæˆæœ¬å¤ªé«˜.<br>æ‰€ä»¥è¿™é‡Œæœ‰ä¸ªå–å·§çš„åŠæ³•,æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª iframeå¹¶è®¾ç½®src=â€about:blankâ€,è¿™ä¸ªæ—¶å€™å¯ä»¥ç¡®ä¿ url åŒåŸŸ,ä¹Ÿä¸ä¼šå‘ç”Ÿèµ„æºåŠ è½½.<br>ç„¶åå–å‡º iframe å¯¹åº”çš„ <strong>contentWindow</strong>,åˆ©ç”¨å…¶<strong>å¤©ç„¶éš”ç¦»</strong>ç‰¹æ€§,çœå»äº†è‡ªå·±å®ç°çš„æˆæœ¬:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨æ²™ç›’ç¯å¢ƒä¸­æ‰§è¡Œä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">evalScript(code: string) &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆ©ç”¨ Functionæ„é€ å‡½æ•°,æ„é€ æ²™ç®±ç¯å¢ƒ,ç»™ code åŠ ä¸€å±‚ wrap,åˆ›å»ºä¸€ä¸ªé—­åŒ…,</span></span><br><span class="line"><span class="comment">   * æŠŠéœ€è¦éš”ç¦»çš„æµè§ˆå™¨åŸç”Ÿå¯¹è±¡å˜æˆä»å‡½æ•°é—­åŒ…ä¸­è·å–</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> resolver = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">`</span></span><br><span class="line"><span class="string">    return function(&#123;window, location, history, document&#125;) &#123;</span></span><br><span class="line"><span class="string">      with(window.__GLOBAL_OVERRIDES_VARS__) &#123;</span></span><br><span class="line"><span class="string">        try &#123;</span></span><br><span class="line"><span class="string">          (function() &#123;</span></span><br><span class="line"><span class="string">            "use strict";</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;code&#125;</span></span></span><br><span class="line"><span class="string">          &#125;)();</span></span><br><span class="line"><span class="string">        &#125; catch(e) &#123;</span></span><br><span class="line"><span class="string">          console.log(e);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span>);</span><br><span class="line">  resolver().call(<span class="keyword">this</span>.window, &#123; ...this &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡proxy ä»£ç† windowçš„è®¿é—®</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">  <span class="keyword">const</span> iframe = <span class="built_in">document</span>.createElement( <span class="string">'iframe'</span> );</span><br><span class="line">  iframe.src = <span class="string">'about:blank'</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(iframe);</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Window</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options, context, iframe) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(iframe.contentWindow, &#123;</span><br><span class="line">        <span class="keyword">set</span>(target, name, value) &#123;</span><br><span class="line">        target[name] = value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">get</span>(target, name) &#123;</span><br><span class="line">        <span class="keyword">switch</span>( name ) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">'document'</span>:</span><br><span class="line">            <span class="keyword">return</span> context.document;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>( <span class="keyword">typeof</span> target[ name ] === <span class="string">'function'</span> &amp;&amp; <span class="regexp">/^[a-z]/</span>.test( name ) )&#123;</span><br><span class="line">          <span class="keyword">return</span> target[ name ].bind &amp;&amp; target[ name ].bind( target );</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> target[ name ];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;ä»€ä¹ˆæ˜¯æ²™ç®±?åŸºæœ¬åŸç†æ˜¯ä»€ä¹ˆ?  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ²™ç®±çš„ç›®çš„å…¶å®å°±æ˜¯éš”ç¦»å˜é‡,ä»£ç†æŸäº›å˜é‡,é˜²æ­¢æ±¡æŸ“å®¿ä¸»ç¯å¢ƒ. &lt;/p&gt;
    
    </summary>
    
      <category term="javascript" scheme="https://lilong7676.github.io/categories/javascript/"/>
    
    
  </entry>
  
  <entry>
    <title>iOSé€†å‘å­¦ä¹ </title>
    <link href="https://lilong7676.github.io/2021/05/09/iOS/iOS%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0/"/>
    <id>https://lilong7676.github.io/2021/05/09/iOS/iOSé€†å‘å­¦ä¹ /</id>
    <published>2021-05-09T08:20:20.000Z</published>
    <updated>2023-06-08T06:26:43.565Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‚è€ƒèµ„æ–™ï¼š</p></blockquote><ul><li><a href="https://www.jianshu.com/p/f229f8df3220" target="_blank" rel="noopener">2019å¹´iOSé€†å‘æœ€æ–°å­¦ä¹ èµ„æ–™ï¼ˆä¸€ï¼‰ï¼šç†è®ºåŸºç¡€å’Œå·¥å…·å‡†å¤‡</a></li><li><a href="https://www.jianshu.com/p/8d42d71fb9e1" target="_blank" rel="noopener">iOSé€†å‘, åŸºç¡€å·¥å…·ä¹‹LLDBå’Œdebugserver</a></li><li><a href="https://juejin.cn/post/6844904094360961037" target="_blank" rel="noopener">debugserver+lldbä½¿ç”¨</a></li><li><a href="https://github.com/AloneMonkey/MonkeyDev/wiki/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8" target="_blank" rel="noopener">MonkeyDev æ–‡æ¡£</a></li><li><a href="https://www.jianshu.com/p/991b13c10c1f" target="_blank" rel="noopener">Cycript åŸºæœ¬ä½¿ç”¨</a></li><li><a href="https://juejin.cn/post/6942419453879517192" target="_blank" rel="noopener">å°è°·çš„è¶³è¿¹2 â€“ iOSé€†å‘å®‰é˜²ä»å…¥é—¨åˆ°ç§ƒå¤´</a></li><li><a href="https://blog.csdn.net/qq_34003239/article/details/97625507" target="_blank" rel="noopener">lldbæ’ä»¶ å¼ºå¤§çš„è°ƒè¯•ç¥å™¨Chisel</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/f229f8df3220&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;2019å¹´iOSé€†å‘æœ€
      
    
    </summary>
    
      <category term="iOS" scheme="https://lilong7676.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://lilong7676.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>macç»ˆç«¯å®ç”¨å‘½ä»¤</title>
    <link href="https://lilong7676.github.io/2019/06/12/Shell%E8%84%9A%E6%9C%AC/%E7%BB%88%E7%AB%AF%E5%AE%9E%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://lilong7676.github.io/2019/06/12/Shellè„šæœ¬/ç»ˆç«¯å®ç”¨å‘½ä»¤/</id>
    <published>2019-06-12T00:16:41.000Z</published>
    <updated>2023-06-08T06:26:43.567Z</updated>
    
    <content type="html"><![CDATA[<p>æŸ¥çœ‹è¯¥ç›®å½•ä¸‹å„ä¸ªæ–‡ä»¶å’Œå­ç›®å½•å„å å¤šå°‘ç©ºé—´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">du -sh *</span><br></pre></td></tr></table></figure><a id="more"></a><p>æ‰¹é‡å¤åˆ¶æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp *.png *.jpeg *.gif /destpath (å‰ªåˆ‡çš„è¯ cpæ¢æˆ mv)</span><br></pre></td></tr></table></figure><p>å¿«é€Ÿåˆ›å»ºä¾¿ç¬º<br>é€‰ä¸­æ–‡å­—ï¼Œç„¶å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shift + command + Y</span><br></pre></td></tr></table></figure><p>ä¿æŒçª—å£çš„æ¿€æ´»çŠ¶æ€<br>å½“ä½ åœ¨å½“å‰çª—å£æ“ä½œæ—¶ï¼Œæƒ³æ‹–æ‹½å…¶ä»–çª—å£ï¼Œ å¯ä»¥æŒ‰ä½<code>command</code>å†è¿›è¡Œæ‹– </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æŸ¥çœ‹è¯¥ç›®å½•ä¸‹å„ä¸ªæ–‡ä»¶å’Œå­ç›®å½•å„å å¤šå°‘ç©ºé—´&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;du -sh *&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Shellè„šæœ¬" scheme="https://lilong7676.github.io/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
      <category term="shell" scheme="https://lilong7676.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>ç¬”è®°ï¼šShellåŸºæœ¬è¯­æ³•</title>
    <link href="https://lilong7676.github.io/2019/06/11/Shell%E8%84%9A%E6%9C%AC/%E7%AC%94%E8%AE%B0%EF%BC%9AShell%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/"/>
    <id>https://lilong7676.github.io/2019/06/11/Shellè„šæœ¬/ç¬”è®°ï¼šShellåŸºæœ¬è¯­æ³•/</id>
    <published>2019-06-11T11:35:01.000Z</published>
    <updated>2023-06-08T06:26:43.567Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// test.sh</span><br><span class="line">#! æ˜¯ä¸€ä¸ªçº¦å®šçš„æ ‡è®°ï¼Œå®ƒå‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªè„šæœ¬éœ€è¦ä»€ä¹ˆè§£é‡Šå™¨æ¥æ‰§è¡Œï¼Œå³ä½¿ç”¨å“ªä¸€ç§ Shellã€‚</span><br><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;hello world&quot;</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¿è¡ŒShellè„šæœ¬çš„æ–¹æ³•</span><br><span class="line">1 ä½œä¸ºå¯æ‰§è¡Œç¨‹åº</span><br><span class="line">chmod +x ./test.sh  #ä½¿è„šæœ¬å…·æœ‰æ‰§è¡Œæƒé™</span><br><span class="line">./test.sh  #æ‰§è¡Œè„šæœ¬</span><br><span class="line">    </span><br><span class="line">2 ä½œä¸ºè§£é‡Šå™¨å‚æ•°</span><br><span class="line">/bin/sh test.sh</span><br></pre></td></tr></table></figure><h1 id="Shellå˜é‡"><a href="#Shellå˜é‡" class="headerlink" title="Shellå˜é‡"></a>Shellå˜é‡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#å®šä¹‰å˜é‡</span><br><span class="line">my_name=&quot;foo&quot;</span><br><span class="line"></span><br><span class="line">#ä½¿ç”¨å˜é‡ åªéœ€è¦åœ¨å˜é‡åå‰åŠ ä¸Š $ ç¬¦å·</span><br><span class="line">echo $my_name</span><br><span class="line">#åŠ èŠ±æ‹¬å·è§†ä¸ºäº†å¸®åŠ©è§£é‡Šå™¨è¯†åˆ«å˜é‡çš„è¾¹ç•Œ</span><br><span class="line">echo $&#123;my_name&#125;</span><br><span class="line"></span><br><span class="line">for skill in Java Coffee; do</span><br><span class="line">    echo &quot;I am good at $&#123;skill&#125;Script&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#ä½¿ç”¨readonlyå°†å˜é‡è®¾ä¸ºåªè¯»å˜é‡</span><br><span class="line">my_name=&quot;foo&quot;</span><br><span class="line">readonly my_name #å¦‚æœå°è¯•ä¿®æ”¹å˜é‡å€¼ï¼Œä¼šæŠ¥é”™</span><br><span class="line">my_name=&quot;bar&quot; #my_name: readonly variable</span><br><span class="line"></span><br><span class="line">#åˆ é™¤å˜é‡</span><br><span class="line">#å˜é‡è¢«åˆ é™¤åä¸èƒ½å†æ¬¡ä½¿ç”¨ã€‚unset å‘½ä»¤ä¸èƒ½åˆ é™¤åªè¯»å˜é‡ã€‚</span><br><span class="line">unset my_name</span><br><span class="line">echo my_name #å°†æ²¡æœ‰ä»»ä½•è¾“å‡º</span><br></pre></td></tr></table></figure><h2 id="shellå˜é‡ç±»å‹-ä¸‰ç§"><a href="#shellå˜é‡ç±»å‹-ä¸‰ç§" class="headerlink" title="shellå˜é‡ç±»å‹ ä¸‰ç§"></a>shellå˜é‡ç±»å‹ ä¸‰ç§</h2><ol><li>å±€éƒ¨å˜é‡</li></ol><p>å±€éƒ¨å˜é‡åœ¨è„šæœ¬æˆ–å‘½ä»¤ä¸­å®šä¹‰ï¼Œä»…åœ¨å½“å‰shellå®ä¾‹ä¸­æœ‰æ•ˆï¼Œå…¶ä»–shellå¯åŠ¨çš„ç¨‹åºä¸èƒ½è®¿é—®å±€éƒ¨å˜é‡</p><ol start="2"><li>ç¯å¢ƒå˜é‡</li></ol><p>æ‰€æœ‰çš„ç¨‹åºï¼ŒåŒ…æ‹¬shellå¯åŠ¨çš„ç¨‹åºï¼Œéƒ½èƒ½è®¿é—®ç¯å¢ƒå˜é‡ï¼Œæœ‰äº›ç¨‹åºéœ€è¦ç¯å¢ƒå˜é‡æ¥ä¿è¯å…¶æ­£å¸¸è¿è¡Œã€‚å¿…è¦çš„æ—¶å€™shellè„šæœ¬ä¹Ÿå¯ä»¥å®šä¹‰ç¯å¢ƒå˜é‡ã€‚ </p><ol start="3"><li><p>shellå˜é‡</p><p>shellå˜é‡æ˜¯ç”±shellç¨‹åºè®¾ç½®çš„ç‰¹æ®Šå˜é‡ã€‚shellå˜é‡ä¸­æœ‰ä¸€éƒ¨åˆ†æ˜¯ç¯å¢ƒå˜é‡ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯å±€éƒ¨å˜é‡ï¼Œè¿™äº›å˜é‡ä¿è¯äº†shellçš„æ­£å¸¸è¿è¡Œ</p><h3 id="shellå­—ç¬¦ä¸²"><a href="#shellå­—ç¬¦ä¸²" class="headerlink" title="shellå­—ç¬¦ä¸²"></a>shellå­—ç¬¦ä¸²</h3><p>å­—ç¬¦ä¸²å¯ä»¥ç”¨å•å¼•å·ï¼Œä¹Ÿå¯ä»¥ç”¨åŒå¼•å·ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å¼•å·ã€‚å•åŒå¼•å·çš„åŒºåˆ«è·ŸPHPç±»ä¼¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> your_name=&quot;foo&quot;</span><br><span class="line"># ä½¿ç”¨åŒå¼•å·æ‹¼æ¥</span><br><span class="line">greeting=&quot;hello, &quot;$your_name&quot; !&quot;</span><br><span class="line">greeting_1=&quot;hello, $&#123;your_name&#125; !&quot;</span><br><span class="line">echo $greeting  $greeting_1</span><br><span class="line"># ä½¿ç”¨å•å¼•å·æ‹¼æ¥</span><br><span class="line">greeting_2=&apos;hello, &apos;$your_name&apos; !&apos;</span><br><span class="line">greeting_3=&apos;hello, $&#123;your_name&#125; !&apos;</span><br><span class="line">echo $greeting_2  $greeting_3</span><br><span class="line"></span><br><span class="line">è¾“å‡º</span><br><span class="line">hello, foo ! hello, foo !</span><br><span class="line">hello, foo ! hello, $&#123;your_name&#125; !</span><br><span class="line"></span><br><span class="line">#è·å–å­—ç¬¦ä¸²çš„é•¿åº¦</span><br><span class="line">str=&quot;abcd&quot;</span><br><span class="line">echo $&#123;#str&#125; #è¾“å‡º 4</span><br><span class="line"></span><br><span class="line">#æå–å­ä¸² </span><br><span class="line">#ä»¥ä¸‹å®ä¾‹ä»å­—ç¬¦ä¸²ç¬¬ 2 ä¸ªå­—ç¬¦å¼€å§‹æˆªå– 4 ä¸ªå­—ç¬¦</span><br><span class="line">str=&quot;hello world&quot;</span><br><span class="line">echo $&#123;str:1:4&#125; $è¾“å‡º ello</span><br><span class="line"></span><br><span class="line">#æŸ¥æ‰¾å­å­—ç¬¦ä¸²çš„ä½ç½®</span><br><span class="line">#æŸ¥æ‰¾å­—ç¬¦ l æˆ– o çš„ä½ç½®(å“ªä¸ªå­—æ¯å…ˆå‡ºç°å°±è®¡ç®—å“ªä¸ª)ï¼š</span><br><span class="line">string=&quot;hello world&quot;</span><br><span class="line">echo `expr index &quot;$string&quot; lo`  # è¾“å‡º 2</span><br></pre></td></tr></table></figure></li></ol><h3 id="shell-æ•°ç»„"><a href="#shell-æ•°ç»„" class="headerlink" title="shell æ•°ç»„"></a>shell æ•°ç»„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#æ•°ç»„ æ•°ç»„å=(å€¼1 å€¼2 ... å€¼n)</span><br><span class="line">arr=(</span><br><span class="line">v1</span><br><span class="line">v2</span><br><span class="line">v3</span><br><span class="line">)</span><br><span class="line">echo &quot;æ•°ç»„ $&#123;arr[1]&#125;&quot;</span><br><span class="line">#ä½¿ç”¨ @ ç¬¦å·å¯ä»¥è·å–æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ </span><br><span class="line">echo â€œæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´  $&#123;arr[@]&#125;â€</span><br><span class="line">#è·å–æ•°ç»„çš„é•¿åº¦</span><br><span class="line">echo &quot;æ•°ç»„çš„é•¿åº¦ $&#123;#arr[@]&#125;&quot;</span><br><span class="line">#æˆ–è€…</span><br><span class="line">echo &quot;æ•°ç»„çš„é•¿åº¦ $&#123;#arr[*]&#125;&quot;</span><br><span class="line">#è·å–æ•°ç»„å•ä¸ªå…ƒç´ çš„é•¿åº¦</span><br><span class="line">echo &quot;æ•°ç»„ç¬¬äºŒä¸ªå…ƒç´ çš„é•¿åº¦ $&#123;#arr[1]&#125;&quot;</span><br><span class="line"></span><br><span class="line">#è¿˜å¯ä»¥å•ç‹¬å®šä¹‰æ•°ç»„çš„å„ä¸ªåˆ†é‡ï¼š</span><br><span class="line"></span><br><span class="line">array_name[0]=value0</span><br><span class="line">array_name[1]=value1</span><br><span class="line">array_name[n]=valuen</span><br></pre></td></tr></table></figure><h3 id="shellä¼ é€’å‚æ•°"><a href="#shellä¼ é€’å‚æ•°" class="headerlink" title="shellä¼ é€’å‚æ•°"></a>shellä¼ é€’å‚æ•°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># $ ./test.sh 1 222 3 4</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;shell ä¼ é€’å‚æ•°å®ä¾‹&quot;</span><br><span class="line">echo &quot;æ‰§è¡Œçš„æ–‡ä»¶å $0&quot;</span><br><span class="line">echo &quot;ç¬¬ä¸€ä¸ªå‚æ•° $1&quot;</span><br><span class="line">echo &quot;ç¬¬äºŒä¸ªå‚æ•° $2&quot;</span><br><span class="line">echo &quot;ç¬¬ä¸‰ä¸ªå‚æ•° $3&quot;</span><br><span class="line">echo &quot;å‚æ•°ä¸ªæ•° $#&quot;</span><br><span class="line">echo &quot;æ‰€æœ‰å‚æ•° $*&quot;</span><br><span class="line">echo &quot;æ‰€æœ‰å‚æ•° åŠ å¼•å· \&quot;$@\&quot;&quot;</span><br><span class="line">echo &quot;è„šæœ¬å½“å‰è¿›ç¨‹ID $$&quot;</span><br><span class="line">echo &quot;åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„ID $!&quot;</span><br><span class="line">echo &quot;shellä½¿ç”¨çš„å½“å‰é€‰é¡¹ $-&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;-- \$* æ¼”ç¤º--&quot;</span><br><span class="line">for i in &quot;$*&quot;; do</span><br><span class="line">echo $i</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;-- \$@ æ¼”ç¤º--&quot;</span><br><span class="line">for i in &quot;$@&quot;; do</span><br><span class="line">echo $i</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#è¾“å‡º</span><br><span class="line">shell ä¼ é€’å‚æ•°å®ä¾‹</span><br><span class="line">æ‰§è¡Œçš„æ–‡ä»¶å ./test.sh</span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•° 1</span><br><span class="line">ç¬¬äºŒä¸ªå‚æ•° 222</span><br><span class="line">ç¬¬ä¸‰ä¸ªå‚æ•° 3</span><br><span class="line">å‚æ•°ä¸ªæ•° 4</span><br><span class="line">æ‰€æœ‰å‚æ•° 1 222 3 4</span><br><span class="line">æ‰€æœ‰å‚æ•° åŠ å¼•å· &quot;1 222 3 4&quot;</span><br><span class="line">è„šæœ¬å½“å‰è¿›ç¨‹ID 20530</span><br><span class="line">åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„ID </span><br><span class="line">shellä½¿ç”¨çš„å½“å‰é€‰é¡¹ hB</span><br><span class="line">-- $* æ¼”ç¤º--</span><br><span class="line">1 222 3 4</span><br><span class="line">-- $@ æ¼”ç¤º--</span><br><span class="line">1</span><br><span class="line">222</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure><h3 id="shellç®—æ•°è¿ç®—"><a href="#shellç®—æ•°è¿ç®—" class="headerlink" title="shellç®—æ•°è¿ç®—"></a>shellç®—æ•°è¿ç®—</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line">echo &quot;a $a, b $b&quot;</span><br><span class="line"></span><br><span class="line">#åŠ æ³•</span><br><span class="line">val=`expr $a + $b`</span><br><span class="line">echo &quot;a + b: $val&quot;</span><br><span class="line"></span><br><span class="line">#ä¹˜æ³• éœ€è¦è½¬ä¹‰</span><br><span class="line">val=`expr $a \* $b`</span><br><span class="line">echo &quot;a * b: $val&quot;</span><br><span class="line"></span><br><span class="line">#é™¤æ³•</span><br><span class="line">val=`expr $b / $a`</span><br><span class="line">echo &quot;b / a: $val&quot;</span><br><span class="line"></span><br><span class="line">#å–ä½™</span><br><span class="line">val=`expr $a % $b`</span><br><span class="line">echo &quot;a % b: $val&quot;</span><br><span class="line"></span><br><span class="line">if [ $a == $b ]</span><br><span class="line">then</span><br><span class="line">echo &quot;a ç­‰äº b&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a != $b ]</span><br><span class="line">then</span><br><span class="line">echo &quot;a ä¸ç­‰äº b&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#è¾“å‡º</span><br><span class="line">a 10, b 20</span><br><span class="line">a + b: 30</span><br><span class="line">a * b: 200</span><br><span class="line">b / a: 2</span><br><span class="line">a % b: 10</span><br><span class="line">a ä¸ç­‰äº b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#æ‰©å±• ä¸‰ç§åŠ æ³•è¿ç®—å†™æ³•</span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line">c=`expr $a + $b`</span><br><span class="line"></span><br><span class="line">echo &quot;c: $c&quot;</span><br><span class="line"></span><br><span class="line">d=$[ `expr $a + $b` ]</span><br><span class="line">echo &quot;d: $d&quot;</span><br><span class="line"></span><br><span class="line">e=$[ 10 + 20 ]</span><br><span class="line">echo &quot;e: $e&quot;</span><br></pre></td></tr></table></figure><h3 id="shell-å…³ç³»è¿ç®—ç¬¦"><a href="#shell-å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="shell å…³ç³»è¿ç®—ç¬¦"></a>shell å…³ç³»è¿ç®—ç¬¦</h3><p>å‡è®¾å˜é‡a=10 b=20</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th><th>ç”¨æ³•ç¤ºä¾‹</th></tr></thead><tbody><tr><td>-eq</td><td>æ£€æµ‹ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰</td><td>[ $a -eq $b ] è¿”å› false</td></tr><tr><td>-nq</td><td>æ£€æµ‹ä¸¤ä¸ªæ•°æ˜¯å¦ä¸ç›¸ç­‰</td><td>[ $a -nq $b]</td></tr><tr><td>-gt</td><td>&gt;</td><td></td></tr><tr><td>-lg</td><td>&lt;</td><td></td></tr><tr><td>-ge</td><td>&gt;=</td><td></td></tr><tr><td>-le</td><td>&lt;=</td><td></td></tr></tbody></table><h3 id="å¸ƒå°”è¿ç®—ç¬¦"><a href="#å¸ƒå°”è¿ç®—ç¬¦" class="headerlink" title="å¸ƒå°”è¿ç®—ç¬¦"></a>å¸ƒå°”è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>!</td><td>éè¿ç®—</td><td>[ !false ] è¿”å›true</td></tr><tr><td>-o</td><td>æˆ–è¿ç®—</td><td>[ $a -lt 20 -o $b -gt 100]</td></tr><tr><td>-a</td><td>ä¸è¿ç®—</td><td></td></tr></tbody></table><h3 id="é€»è¾‘è¿ç®—ç¬¦"><a href="#é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="é€»è¾‘è¿ç®—ç¬¦"></a>é€»è¾‘è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>&amp;&amp;</td><td>é€»è¾‘AND</td><td>[[ $a -lt 100 &amp;&amp; $b -gt 100 ]]</td></tr><tr><td>`</td><td></td><td>`</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line">if [[ $a -lt 100 &amp;&amp; $b -gt 100 ]]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $a -lt 100 || $b -gt 100 ]]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²è¿ç®—ç¬¦"><a href="#å­—ç¬¦ä¸²è¿ç®—ç¬¦" class="headerlink" title="å­—ç¬¦ä¸²è¿ç®—ç¬¦"></a>å­—ç¬¦ä¸²è¿ç®—ç¬¦</h3><p>å‡è®¾å˜é‡a=â€abcâ€ b=â€efgâ€</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th><th>ä¸¾ä¾‹</th></tr></thead><tbody><tr><td>=</td><td>æ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</td><td>[ $a =$b ]è¿”å›false</td></tr><tr><td>!=</td><td></td><td></td></tr><tr><td>-z</td><td>æ£€æµ‹å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ï¼Œä¸º0è¿”å›true</td><td>[ -z $a ] false</td></tr><tr><td>-n</td><td>æ£€æµ‹å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸ä¸º0</td><td>[ -n â€œ$aâ€ ] true</td></tr><tr><td>str</td><td>æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¿”å›true</td><td>[ $a ] true</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tips</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ [[ ... ]] æ¡ä»¶åˆ¤æ–­ç»“æ„ï¼Œè€Œä¸æ˜¯ [ ... ]ï¼Œèƒ½å¤Ÿé˜²æ­¢è„šæœ¬ä¸­çš„è®¸å¤šé€»è¾‘é”™è¯¯ã€‚</span><br><span class="line">æ¯”å¦‚ï¼Œ&amp;&amp;ã€||ã€&lt; å’Œ &gt; æ“ä½œç¬¦èƒ½å¤Ÿæ­£å¸¸å­˜åœ¨äº [[ ]] æ¡ä»¶åˆ¤æ–­ç»“æ„ä¸­ï¼Œä½†æ˜¯å¦‚æœå‡ºç°åœ¨ [ ] ç»“æ„ä¸­çš„è¯ï¼Œä¼šæŠ¥é”™ã€‚</span><br></pre></td></tr></table></figure><h3 id="printfè¾“å‡º"><a href="#printfè¾“å‡º" class="headerlink" title="printfè¾“å‡º"></a>printfè¾“å‡º</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">printf å‘½ä»¤æ¨¡ä»¿ C ç¨‹åºåº“ï¼ˆlibraryï¼‰é‡Œçš„ printf() ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">printf ç”± POSIX æ ‡å‡†æ‰€å®šä¹‰ï¼Œå› æ­¤ä½¿ç”¨ printf çš„è„šæœ¬æ¯”ä½¿ç”¨ echo ç§»æ¤æ€§å¥½ã€‚</span><br><span class="line"></span><br><span class="line">printf ä½¿ç”¨å¼•ç”¨æ–‡æœ¬æˆ–ç©ºæ ¼åˆ†éš”çš„å‚æ•°ï¼Œå¤–é¢å¯ä»¥åœ¨ printf ä¸­ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥åˆ¶å®šå­—ç¬¦ä¸²çš„å®½åº¦ã€å·¦å³å¯¹é½æ–¹å¼ç­‰ã€‚é»˜è®¤ printf ä¸ä¼šåƒ echo è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ·»åŠ  \nã€‚</span><br><span class="line"></span><br><span class="line">printf å‘½ä»¤çš„è¯­æ³•ï¼š</span><br><span class="line"></span><br><span class="line">printf  format-string  [arguments...]</span><br><span class="line">å‚æ•°è¯´æ˜ï¼š</span><br><span class="line"></span><br><span class="line">format-string: ä¸ºæ ¼å¼æ§åˆ¶å­—ç¬¦ä¸²</span><br><span class="line">arguments: ä¸ºå‚æ•°åˆ—è¡¨ã€‚</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">printf &quot;%-10s %-8s %-4s\n&quot; å§“å æ€§åˆ« ä½“é‡kg  </span><br><span class="line">printf &quot;%-10s %-8s %-4.2f\n&quot; éƒ­é– ç”· 66.1234 </span><br><span class="line">printf &quot;%-10s %-8s %-4.2f\n&quot; æ¨è¿‡ ç”· 48.6543 </span><br><span class="line">printf &quot;%-10s %-8s %-4.2f\n&quot; éƒ­èŠ™ å¥³ 47.9876 </span><br><span class="line"></span><br><span class="line"># format-stringä¸ºåŒå¼•å·</span><br><span class="line">printf &quot;%d %s\n&quot; 1 &quot;abc&quot;</span><br><span class="line"></span><br><span class="line"># å•å¼•å·ä¸åŒå¼•å·æ•ˆæœä¸€æ · </span><br><span class="line">printf &apos;%d %s\n&apos; 1 &quot;abc&quot; </span><br><span class="line"></span><br><span class="line"># æ²¡æœ‰å¼•å·ä¹Ÿå¯ä»¥è¾“å‡º</span><br><span class="line">printf %s abcdef</span><br><span class="line"></span><br><span class="line"># æ ¼å¼åªæŒ‡å®šäº†ä¸€ä¸ªå‚æ•°ï¼Œä½†å¤šå‡ºçš„å‚æ•°ä»ç„¶ä¼šæŒ‰ç…§è¯¥æ ¼å¼è¾“å‡ºï¼Œformat-string è¢«é‡ç”¨</span><br><span class="line">printf %s abc def</span><br><span class="line"></span><br><span class="line">printf &quot;%s\n&quot; abc def</span><br><span class="line"></span><br><span class="line">printf &quot;%s %s %s\n&quot; a b c d e f g h i j</span><br><span class="line"></span><br><span class="line"># å¦‚æœæ²¡æœ‰ argumentsï¼Œé‚£ä¹ˆ %s ç”¨NULLä»£æ›¿ï¼Œ%d ç”¨ 0 ä»£æ›¿</span><br><span class="line">printf &quot;%s and %d \n&quot;</span><br><span class="line"></span><br><span class="line">#è¾“å‡º</span><br><span class="line">å§“å     æ€§åˆ«   ä½“é‡kg</span><br><span class="line">éƒ­é–     ç”·      66.12</span><br><span class="line">æ¨è¿‡     ç”·      48.65</span><br><span class="line">éƒ­èŠ™     å¥³      47.99</span><br><span class="line">1 abc</span><br><span class="line">1 abc</span><br><span class="line">abcdefabcdefabc</span><br><span class="line">def</span><br><span class="line">a b c</span><br><span class="line">d e f</span><br><span class="line">g h i</span><br><span class="line">j  </span><br><span class="line"> and 0</span><br></pre></td></tr></table></figure><h3 id="shellæµç¨‹æ§åˆ¶"><a href="#shellæµç¨‹æ§åˆ¶" class="headerlink" title="shellæµç¨‹æ§åˆ¶"></a>shellæµç¨‹æ§åˆ¶</h3><p>if æ¡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line">if test $a -lt $b; then</span><br><span class="line">printf &apos;%s\n&apos; &quot;a &lt; b&quot;</span><br><span class="line">elif [[ $a -gt $b ]]; then</span><br><span class="line">echo &quot;a &gt; b&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>for å¾ªç¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for a in 1 2 3 4 5; do</span><br><span class="line">echo $a  #ä¸è¦å¿˜äº†å˜é‡å‰åŠ  $</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#ç¬¬äºŒç§å†™æ³•,ç±»ä¼¼äºCè¯­è¨€å†™æ³•</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">for((i=1;i&lt;=5;i++));do</span><br><span class="line">    echo &quot;è¿™æ˜¯ç¬¬ $i æ¬¡è°ƒç”¨&quot;</span><br><span class="line">done;</span><br></pre></td></tr></table></figure><p>while è¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">while condition</span><br><span class="line">do</span><br><span class="line">    command</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">i=1</span><br><span class="line">while(( $i&lt;5 ))</span><br><span class="line">do</span><br><span class="line">echo $i</span><br><span class="line">i=`expr $i + 1`</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>until è¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">a=0</span><br><span class="line"></span><br><span class="line">until [ ! $a -lt 10 ]</span><br><span class="line">do</span><br><span class="line">   echo $a</span><br><span class="line">   a=`expr $a + 1`</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>case è¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">caseçš„è¯­æ³•å’ŒC familyè¯­è¨€å·®åˆ«å¾ˆå¤§</span><br><span class="line">å®ƒéœ€è¦ä¸€ä¸ªesacï¼ˆå°±æ˜¯caseåè¿‡æ¥ï¼‰ä½œä¸ºç»“æŸæ ‡è®°</span><br><span class="line">æ¯ä¸ªcaseåˆ†æ”¯ç”¨å³åœ†æ‹¬å·ï¼Œç”¨ä¸¤ä¸ªåˆ†å·è¡¨ç¤ºbreakã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">echo &apos;è¾“å…¥ 1 åˆ° 4 ä¹‹é—´çš„æ•°å­—:&apos;</span><br><span class="line">echo &apos;ä½ è¾“å…¥çš„æ•°å­—ä¸º:&apos;</span><br><span class="line">read aNum</span><br><span class="line">case $aNum in               #å˜é‡åé¢å¿…é¡»è·Ÿä¸Š in</span><br><span class="line">    1)  echo &apos;ä½ é€‰æ‹©äº† 1&apos;   #æ¯ä¸€ä¸ªæ¨¡å¼å¿…é¡»ä»¥å³æ‹¬å·ç»“æŸ</span><br><span class="line">    ;;                      #ç›¸å½“äºbreak;</span><br><span class="line">    2)  echo &apos;ä½ é€‰æ‹©äº† 2&apos;</span><br><span class="line">    ;;</span><br><span class="line">    3)  echo &apos;ä½ é€‰æ‹©äº† 3&apos;</span><br><span class="line">    ;;</span><br><span class="line">    4)  echo &apos;ä½ é€‰æ‹©äº† 4&apos;</span><br><span class="line">    ;;</span><br><span class="line">    # * ç›¸å½“äº default</span><br><span class="line">    *)  echo &apos;ä½ æ²¡æœ‰è¾“å…¥ 1 åˆ° 4 ä¹‹é—´çš„æ•°å­—&apos;</span><br><span class="line">    ;;</span><br><span class="line">esac    #ç»“æŸcase</span><br></pre></td></tr></table></figure><p>è·³å‡ºå¾ªç¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">break</span><br><span class="line">continue</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#å®šä¹‰å‡½æ•°</span><br><span class="line">demoFun()&#123;</span><br><span class="line">echo &quot;ç¬¬ä¸€ä¸ªshellå‡½æ•°&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#æ‰§è¡Œå‡½æ•°</span><br><span class="line">demoFun</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###å¸¦è¿”å›å€¼çš„å‡½æ•°</span><br><span class="line">funcWithReturn () &#123;</span><br><span class="line">echo &quot;è¾“å…¥a&quot;</span><br><span class="line">read a</span><br><span class="line">echo &quot;è¾“å…¥b&quot;</span><br><span class="line">read b</span><br><span class="line"></span><br><span class="line">echo -e &quot;a + b = \c&quot;</span><br><span class="line">return $(($a + $b))</span><br><span class="line">&#125;</span><br><span class="line">#æ‰§è¡Œå‡½æ•°</span><br><span class="line">funcWithReturn</span><br><span class="line">#é€šè¿‡ $?è·å–å‡½æ•°æ‰§è¡Œåçš„è¿”å›å€¼</span><br><span class="line">echo &quot;$?&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###ç»™å‡½æ•°ä¼ å‚</span><br><span class="line">funWithParam () &#123;</span><br><span class="line">echo $@</span><br><span class="line">echo &quot;å‚æ•°æ€»æ•°æœ‰ $# ä¸ª!&quot;</span><br><span class="line">    echo &quot;ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºæ‰€æœ‰å‚æ•° $* !&quot;</span><br><span class="line">i=1</span><br><span class="line">for arg in $@; do</span><br><span class="line">echo &quot;ç¬¬$&#123;i&#125;ä¸ªå‚æ•°ä¸º $arg&quot;</span><br><span class="line">i=$(($i+1))</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">funWithParam 1 2 3 4 5</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// test.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#! æ˜¯ä¸€ä¸ªçº¦å®šçš„æ ‡è®°ï¼Œå®ƒå‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªè„šæœ¬éœ€è¦ä»€ä¹ˆè§£é‡Šå™¨æ¥æ‰§è¡Œï¼Œå³ä½¿ç”¨å“ªä¸€ç§ Shellã€‚&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;quot;hello world&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Shellè„šæœ¬" scheme="https://lilong7676.github.io/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
      <category term="shell" scheme="https://lilong7676.github.io/tags/shell/"/>
    
  </entry>
  
</feed>
